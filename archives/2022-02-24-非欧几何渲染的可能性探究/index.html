<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>非欧几何渲染的可能性探究 | 虚空之地</title><meta name="keywords" content="渲染,几何"><meta name="author" content="逯晓零"><meta name="copyright" content="逯晓零"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="渲染这东西，学得真的简直不要太无聊，重复的东西学一遍，再仿写一遍代码，最后呢？还是得用别人封装好的东西来应用于实际的开发，我一直很疑惑，渲染这玩意除了硬件上升一个层数，算法真的有优化的余地吗？当然我认为的实际的情况是，如今的渲染已经基本满足需求了，不过事实如何，那就不得而知了。   非欧几何今天想讨论的主题是非欧几何的渲染问题，注意我们不会提及光照相关的东西，因为笔者都还在学习呢！而我们现在的目标">
<meta property="og:type" content="article">
<meta property="og:title" content="非欧几何渲染的可能性探究">
<meta property="og:url" content="http://example.com/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/index.html">
<meta property="og:site_name" content="虚空之地">
<meta property="og:description" content="渲染这东西，学得真的简直不要太无聊，重复的东西学一遍，再仿写一遍代码，最后呢？还是得用别人封装好的东西来应用于实际的开发，我一直很疑惑，渲染这玩意除了硬件上升一个层数，算法真的有优化的余地吗？当然我认为的实际的情况是，如今的渲染已经基本满足需求了，不过事实如何，那就不得而知了。   非欧几何今天想讨论的主题是非欧几何的渲染问题，注意我们不会提及光照相关的东西，因为笔者都还在学习呢！而我们现在的目标">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-02-24T12:07:32.000Z">
<meta property="article:modified_time" content="2022-10-14T23:47:11.549Z">
<meta property="article:author" content="逯晓零">
<meta property="article:tag" content="渲染">
<meta property="article:tag" content="几何">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '非欧几何渲染的可能性探究',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-15 07:47:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">65</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/words/"><i class="fa-fw fa fa-snowflake"></i><span> 动态</span></a></div><div class="menus_item"><a class="site-page" href="/articles/"><i class="fa-fw fa fa-book"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/dream/"><i class="fa-fw fa fa-lightbulb"></i><span> 绘梦</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">虚空之地</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/words/"><i class="fa-fw fa fa-snowflake"></i><span> 动态</span></a></div><div class="menus_item"><a class="site-page" href="/articles/"><i class="fa-fw fa fa-book"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/dream/"><i class="fa-fw fa fa-lightbulb"></i><span> 绘梦</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">非欧几何渲染的可能性探究</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-24T12:07:32.000Z" title="发表于 2022-02-24 20:07:32">2022-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-14T23:47:11.549Z" title="更新于 2022-10-15 07:47:11">2022-10-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>渲染这东西，学得真的简直不要太无聊，重复的东西学一遍，再仿写一遍代码，最后呢？还是得用别人封装好的东西来应用于实际的开发，我一直很疑惑，渲染这玩意除了硬件上升一个层数，算法真的有优化的余地吗？当然我认为的实际的情况是，如今的渲染已经基本满足需求了，不过事实如何，那就不得而知了。  </p>
<h1 id="非欧几何"><a href="#非欧几何" class="headerlink" title="非欧几何"></a>非欧几何</h1><p>今天想讨论的主题是非欧几何的渲染问题，注意我们不会提及光照相关的东西，因为笔者都还在学习呢！而我们现在的目标是弄清非欧几何是什么？泛泛地来讲，不是欧式几何的都是非欧几何。稍微学过几何的人会认为，依欧几里得第五公理的不同，而产生的双曲几何(又称罗巴切夫基几何)，球面几何(狭义黎曼几何)，称为非欧几何。其实都不能算错，关键在于怎么看待它，我们需要提两个要点，首先单纯从公理的角度，欧几里得的五条公理并不完备，大多证明依旧依赖直观，而完备的公理体系应该是希尔伯特在几何基础里所给的五组公理。其次，黎曼几何是微分几何里十分重要的部分，不单只是球面或者椭圆上的几何。相信许多了解非欧几何的人，都喜欢在球面或伪球面上进行思考。确实如此，这也是如今对非欧几何的一个统一看法，那为什么常被讨论的非欧几何只有两种呢？符合直觉的一个很重要的点就是性质不随位置改变，比如三角形不论放在哪里内角和都是固定的，170、180、又或者190之类的。注意我们只在2维的平面上，所以考虑模型的时候则是3维空间中的曲面，要求各点性质不变其实很复杂，关键在于什么样的性质，比如Gauss-Bonnet公式表明了角度和与测地曲率和高斯曲率的关系，由于我们通常将曲面上测地线选取为直线，所以内角和实际只要求高斯曲率为定值。在通常认知下，区分非欧几何的平行公理，实际也与角度相关，所以我们一般认知的非欧几何就正好对应高斯曲率为正定值和负定值的情况，而高斯曲率为零就要注意了，不单只有平面，还包括柱面锥面等可展曲面，依据是否有脐点还有进一步的区分，就不讲了。数学很神奇，也很复杂，你只要考虑十分理想的情况就行了，常高斯曲率我们就分三种情况，平面、球面和伪球面。对于一些拥有奇特性质的几何可以放在高维欧式空间来理解这一事实，其实是有数学定理支持的，Whitney浸入定理和Whitney嵌入定理，通俗来讲就是，能计量的几何(局部欧式化的流形)可以对应到更高维欧式空间的图形上。比如，二维的罗氏几何可以对应到三维欧式空间的伪球面(也称双曲面，本质是高斯曲率为负常数的旋转面)上的几何。说了这么多，总结就两句话，非欧几何十分多样不只两种，一般的非欧几何都可以在更高维的欧式空间中表现出来。</p>
<h1 id="两个项目实例"><a href="#两个项目实例" class="headerlink" title="两个项目实例"></a>两个项目实例</h1><p>在Github上，我随手搜了一下NonEuclidean，然后挑选了比较有代表的两个来讲讲吧，当然项目太老，OpenGL版本太低，我的电脑运行不了，只能看他们的演示和源码了，<a target="_blank" rel="noopener" href="https://github.com/HackerPoet/NonEuclidean">项目1</a>和<a target="_blank" rel="noopener" href="https://github.com/fyr233/nonEuclidGraphics">项目2</a>。</p>
<h2 id="项目1"><a href="#项目1" class="headerlink" title="项目1"></a>项目1</h2><p>直接给结论，这大概和非欧几何没有关系。这个项目的关键部分是下面这个Portal类，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p1.png" class="">  
<p>我们来详细讲讲它到底能做些什么，它是Object类的子类，Object是所有渲染对象的父类，提供了它们所需的共有属性，如位置、旋转和缩放，包括绘制，而Portal则拥有着独特的绘制函数，也因此使它成为了整个项目的核心。这里稍微提一下，这个项目的渲染循环，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p2.png" class="">  
<p>我们可以看到关键在于两个函数Update和Render，前者将当前的参数计算好，后者将实际画面绘制到屏幕上。从下面的Render代码，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p3.png" class="">  
<p>我们可以知道，它完成了两件事碰撞处理和Portal相关处理，对于前者主要是下面这个情形，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p4.png" class="">  
<p>即玩家体积过大，进不了小洞口，而Portal的处理则与Portal的功能相关。所谓Portal实际上是一个传送门，而这个传送门可以看到对面的景象，我们拿第一个例子来说明，演示如下  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p5.png" class="">  
<p>代码如下  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p6.png" class="">  
<p>我们可以看到，它安排了两个Tunnel(隧道)和四个Portal。隧道可以设置两个Portal，两个Portal之间可以Connect，仔细看代码，我们可以发现隧道的两个Portal并没有连接，而是与另一个隧道的Portal连接。什么是连接(Connect)，Portal又是什么，我们还是得看它的源码。Portal有两个面front和back，使用Warp进行封装，而Warp保存这个面的所指向的两个Portal，表示从哪里来又到哪里去。总的来说一个Portal可以连接两个Portal，分别放在两个面上，至于它对应的模型“double_quad.obj”，在blender里打开可以得到，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p7.png" class="">  
<p>其实就是一个矩形，没有厚度，有两个面，符合类的需求。我们稍微看一下Draw的代码，</p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p8.png" class="">  
<p>在42行，我们可以看到一个关键的技术——帧缓存，这个功能很好理解，可以把它理解成一个可以放在任何位置的实时照片，代码层面就是渲染某个场景后将它保存为贴图，放到另一个渲染场景中去，这也是实现Portal的关键。首先是测量我们处于Portal的前面还是后面，接着到相应的目标地来建立相机，然后渲染场景保存到帧缓存中，最后完成当前Portal的渲染。所以，我们在front面可以看到toPortal所在位置的画面，在back面可以看到fromPortal所在位置的画面。其实进入Portal的时候，也是会实现传送功能的，就是改一下Player的位置就行了，而检测发生在我们之前提到的Update里面，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p9.png" class="">  
<p>方法是比较常规的遍历，首先遍历所有的Object，前提它是Physical，目前只有玩家具有物理性，然后对每个Portal进行碰撞检测，不算优秀但也不差。到现在，我们也可以还原第一个场景到底做了些什么了，如下图  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p10.png" class="">  
<p>也就是空间本质上没有增减，只是内部空间从视觉上换位了，至于后面的几个场景本质都一样，只不过有时它会将多余的空间放到较远的地方，比如第二个Level2——将6个房间藏于4个房间内。其实Portal的原理在××门之类的mod里就有，也不是什么新奇的东西，只是帧缓存的一个用法，其实在演示的最后，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p11.png" class="">  
<p>作者也提了一下Portal的原理，但讲得不是很深就是了。至此项目分析的差不多了，从纯数学的角度，它不是非欧几何，因为物质影响空间的性质并不合理，而应当是更纯粹的几何才对，当然你要和我说广义相对论的话，我只能说我了解的不够深入。</p>
<h2 id="项目2"><a href="#项目2" class="headerlink" title="项目2"></a>项目2</h2><p>接下来的这个项目就的确有非欧几何的样子了，我们来详细地研读一番吧。因为涉及很多定量的东西，我们稍微回顾一下OpenGL的渲染流程和思想，然后再谈如何进行非欧的改造。</p>
<h3 id="OpenGL渲染流程"><a href="#OpenGL渲染流程" class="headerlink" title="OpenGL渲染流程"></a>OpenGL渲染流程</h3><p>现代的OpenGL渲染管线如下图  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p12.png" class="">  
<p>当然它并没有说清，如何渲染，又如何与代码产生联系的，只是单纯说明了渲染在GPU内的流程，其中蓝色表示可以控制的部分。拿出我之前在渲染游记中提到的例子，GPU渲染包含两部分代码，一是在CPU上的我们所运行的可以可以与GPU交互的程序，另一个是运行在GPU上的有输入和输出的程序，即着色器。OpenGL渲染就两步，设置状态参数和执行渲染命令，设置步骤拥有着最多部分的代码，如设置渲染的顶点数据VertexBuffer，设置渲染的Shader，由CPU向GPU传递Uniform等。<br>有关渲染我们需要注意几点，点的数据只使用规范化坐标，限制在正负一内；基本图只有点和线，并没有如圆一样的曲线；点或点组或片段是并行处理的，相互之间不太容易交流。在OpenGL由CPU传入的一个点可以存储不止3个数据，最大值由显卡决定，而最后确定顶点位置的实际是顶点着色器的输出，是一个4维向量，也就是说传入顶点的实际作用是确定有几个点，执行了当前顶点着色器多少次，而传入的顶点用于区分是哪一次。为了说明这件事，我来举个简单的例子，如下，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p13.png" class="">  
<p>红色是原来例子的修改部分，可以看到VertexBuffer并没有提供完整的数据，而是顶点着色器中进行补全的，当然我们不推荐这样的做法，主要因为通常情况下，从模型中读取的顶点数据是在CPU中，不能直接传到GPU里去，而且在GPU中进行逻辑运算不是明智之举，这个实例主要用于说明顶点最终在顶点着色器中以四维向量确定。<br>gl_Position的寿命应该维持到了光栅化阶段，当然这是猜的，因为在几何着色器我们任可以操作gl_Position完成图元的绘制，不过依旧限制在正负一内就是了，而到片段着色器的时候只能使用gl_FragCoord变量确定位置，并且只有2个分量x和y，坐标是窗口坐标。实际上gl_FragCoord有个z分量，但主要用于深度测试，表示将什么绘制在前面。gl_Position到gl_FragCoord到底发生了什么呢？首先是，前三个分量分别除以第四个分量，z作为深度，而规范化的x和y则对应到屏幕上去，对应代码中的glViewport的区域。这里其实有说明了一个事实，OpenGL并没有3维识别的能力，而是将z作为谁在前面的指标，当然也可以对深度测试进行调参，这对以后透视视图的理解有一定帮助。至于为什么使用四维向量来表示位置，实际主要是便于运算，我们接下来会讲。</p>
<h3 id="坐标系统"><a href="#坐标系统" class="headerlink" title="坐标系统"></a>坐标系统</h3><p>如果直接使用OpenGL的坐标系统是十分不方便的，比如坐标限制在正负一，随不同的屏幕会得到不同的效果，而且原生的绘制流程是平行投影，不能达到符合现实的效果。我们也很容易发现，单纯绘制二维图形流程也太复杂了，实际上这样的流程本来就是为3维图形服务的，而现在你拥有了修改源代码的权利罢了。而我接下来说的这套坐标系统，其实可能就是OpenGL1.x版本的源码，不过确定就是了，但这流程在哪里基本都是不变的。<br>我们知道顶点最终是在顶点着色器中确定的，所以我们最终的目的就是将我们的坐标系统变换到gl_Position所需要的规范化坐标去，输出结果是一个点，一个四维向量，输入存储在VertexBuffer里是一个不定维的向量，一般情况下我们只取前三位，其它部分用于保存如纹理坐标，法向量之类的数据，当前用不到就不管了，输入坐标我们经常会这么写<code>vec4(aPos, 1.0)</code>，aPos输入的坐标数据，这其实是渲染中的习惯，以第四个分量为1表示点，以第四个分量为0表示向量。相信搞过游戏开发的都知道对于一个实体，都有一个叫锚点(anchor)的东西，也称局部坐标，而我们传入的点集所处的坐标系正是这个局部坐标，这样对于绘制有许多便利之处。学过线性代数的同学应该知道，我们要将这个初始的四维向量变化到目标的四维向量是，如果要充分利用GPU的计算力，使用4*4矩阵进行乘法是比较便利的。大量的实践表明，使用下面的变化式是较为合适的  </p>
<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.666ex" xmlns="http://www.w3.org/2000/svg" width="36.58ex" height="2.211ex" role="img" focusable="false" viewBox="0 -683 16168.2 977.2" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-16-TEX-I-1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path id="MJX-16-TEX-I-1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path id="MJX-16-TEX-I-1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-16-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-16-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-16-TEX-I-1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path><path id="MJX-16-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path><path id="MJX-16-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-16-TEX-I-1D457" d="M297 596Q297 627 318 644T361 661Q378 661 389 651T403 623Q403 595 384 576T340 557Q322 557 310 567T297 596ZM288 376Q288 405 262 405Q240 405 220 393T185 362T161 325T144 293L137 279Q135 278 121 278H107Q101 284 101 286T105 299Q126 348 164 391T252 441Q253 441 260 441T272 442Q296 441 316 432Q341 418 354 401T367 348V332L318 133Q267 -67 264 -75Q246 -125 194 -164T75 -204Q25 -204 7 -183T-12 -137Q-12 -110 7 -91T53 -71Q70 -71 82 -81T95 -112Q95 -148 63 -167Q69 -168 77 -168Q111 -168 139 -140T182 -74L193 -32Q204 11 219 72T251 197T278 308T289 365Q289 372 288 376Z"></path><path id="MJX-16-TEX-I-1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path id="MJX-16-TEX-I-1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path id="MJX-16-TEX-I-1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path id="MJX-16-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-16-TEX-N-B7" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"></path><path id="MJX-16-TEX-I-1D463" d="M173 380Q173 405 154 405Q130 405 104 376T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Q21 294 29 316T53 368T97 419T160 441Q202 441 225 417T249 361Q249 344 246 335Q246 329 231 291T200 202T182 113Q182 86 187 69Q200 26 250 26Q287 26 319 60T369 139T398 222T409 277Q409 300 401 317T383 343T365 361T357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159T347 40T241 -11Q177 -11 139 22Q102 54 102 117Q102 148 110 181T151 298Q173 362 173 380Z"></path><path id="MJX-16-TEX-I-1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"></path><path id="MJX-16-TEX-I-1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-16-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path id="MJX-16-TEX-I-1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D449" xlink:href="#MJX-16-TEX-I-1D449"></use></g><g data-mml-node="TeXAtom" transform="translate(616,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45C" xlink:href="#MJX-16-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(485,0)"><use data-c="1D462" xlink:href="#MJX-16-TEX-I-1D462"></use></g><g data-mml-node="mi" transform="translate(1057,0)"><use data-c="1D461" xlink:href="#MJX-16-TEX-I-1D461"></use></g></g></g><g data-mml-node="mo" transform="translate(1946.5,0)"><use data-c="3D" xlink:href="#MJX-16-TEX-N-3D"></use></g><g data-mml-node="msub" transform="translate(3002.2,0)"><g data-mml-node="mi"><use data-c="1D440" xlink:href="#MJX-16-TEX-I-1D440"></use></g><g data-mml-node="TeXAtom" transform="translate(1003,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45D" xlink:href="#MJX-16-TEX-I-1D45D"></use></g><g data-mml-node="mi" transform="translate(503,0)"><use data-c="1D45F" xlink:href="#MJX-16-TEX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(954,0)"><use data-c="1D45C" xlink:href="#MJX-16-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(1439,0)"><use data-c="1D457" xlink:href="#MJX-16-TEX-I-1D457"></use></g><g data-mml-node="mi" transform="translate(1851,0)"><use data-c="1D452" xlink:href="#MJX-16-TEX-I-1D452"></use></g><g data-mml-node="mi" transform="translate(2317,0)"><use data-c="1D450" xlink:href="#MJX-16-TEX-I-1D450"></use></g><g data-mml-node="mi" transform="translate(2750,0)"><use data-c="1D461" xlink:href="#MJX-16-TEX-I-1D461"></use></g><g data-mml-node="mi" transform="translate(3111,0)"><use data-c="1D456" xlink:href="#MJX-16-TEX-I-1D456"></use></g><g data-mml-node="mi" transform="translate(3456,0)"><use data-c="1D45C" xlink:href="#MJX-16-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(3941,0)"><use data-c="1D45B" xlink:href="#MJX-16-TEX-I-1D45B"></use></g></g></g><g data-mml-node="mo" transform="translate(7488.4,0)"><use data-c="B7" xlink:href="#MJX-16-TEX-N-B7"></use></g><g data-mml-node="msub" transform="translate(7988.6,0)"><g data-mml-node="mi"><use data-c="1D440" xlink:href="#MJX-16-TEX-I-1D440"></use></g><g data-mml-node="TeXAtom" transform="translate(1003,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D463" xlink:href="#MJX-16-TEX-I-1D463"></use></g><g data-mml-node="mi" transform="translate(485,0)"><use data-c="1D456" xlink:href="#MJX-16-TEX-I-1D456"></use></g><g data-mml-node="mi" transform="translate(830,0)"><use data-c="1D452" xlink:href="#MJX-16-TEX-I-1D452"></use></g><g data-mml-node="mi" transform="translate(1296,0)"><use data-c="1D464" xlink:href="#MJX-16-TEX-I-1D464"></use></g></g></g><g data-mml-node="mo" transform="translate(10686.6,0)"><use data-c="B7" xlink:href="#MJX-16-TEX-N-B7"></use></g><g data-mml-node="msub" transform="translate(11186.8,0)"><g data-mml-node="mi"><use data-c="1D440" xlink:href="#MJX-16-TEX-I-1D440"></use></g><g data-mml-node="TeXAtom" transform="translate(1003,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D45A" xlink:href="#MJX-16-TEX-I-1D45A"></use></g><g data-mml-node="mi" transform="translate(878,0)"><use data-c="1D45C" xlink:href="#MJX-16-TEX-I-1D45C"></use></g><g data-mml-node="mi" transform="translate(1363,0)"><use data-c="1D451" xlink:href="#MJX-16-TEX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(1883,0)"><use data-c="1D452" xlink:href="#MJX-16-TEX-I-1D452"></use></g><g data-mml-node="mi" transform="translate(2349,0)"><use data-c="1D459" xlink:href="#MJX-16-TEX-I-1D459"></use></g></g></g><g data-mml-node="mo" transform="translate(14333.7,0)"><use data-c="B7" xlink:href="#MJX-16-TEX-N-B7"></use></g><g data-mml-node="msub" transform="translate(14833.9,0)"><g data-mml-node="mi"><use data-c="1D449" xlink:href="#MJX-16-TEX-I-1D449"></use></g><g data-mml-node="TeXAtom" transform="translate(616,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="1D456" xlink:href="#MJX-16-TEX-I-1D456"></use></g><g data-mml-node="mi" transform="translate(345,0)"><use data-c="1D45B" xlink:href="#MJX-16-TEX-I-1D45B"></use></g></g></g></g></g></svg></mjx-container>  
<p>其中V表示向量，M表示矩阵。至于矩阵如何完成点的平移、旋转、缩放和坐标系变化，就真的没讲的必要了。矩阵从左到右我们依次称为投影矩阵、视图矩阵和模型矩阵，而这些矩阵通过Uniform由CPU传入GPU，首先，我们假想一个世界坐标，它单单只是数据，并不存在于OpenGL中，模型矩阵就是用于确定数据点集在这个世界坐标中的位置旋转和缩放的，也就是通过模型矩阵运算后，这个模型才真正确定，这样有一个明显的好处，如果绘制相同模型的图形时，我们只要一套点集数据，通过变化模型矩阵即可，这样可以极大的节约数据所占用的内存。视图矩阵则将世界坐标变化到视图所在的坐标(俗称相机)，通过对这个矩阵的调整，我们可以模拟在这个看似3维却不是3维的空间中自由移动。最后一个矩阵主要用于在这个视图坐标中圈一块空间，并映射到规范化坐标中去，平行投影与透视投影也是在这里实现的，也包括长宽比的确定，透视实现的方式并不难，只要将视线上的点的x和y坐标变化到相同即可，实际操作中用到了第四个分量，这样便于将视线上的点平分到正负一内用于深度测试，不过通常只用了正数部分，这样也符合常识。值得一提的是，裁剪其实是在几何着色器之后执行的，方法也很简单判断坐标是否在正负一内即可。</p>
<h3 id="项目浅析"><a href="#项目浅析" class="headerlink" title="项目浅析"></a>项目浅析</h3><p>终于回到了这个项目，我要提前说一点，我对这个项目的光相关内容存在质疑，所以我们不考虑这部分，至于原因，先看看我对几何部分的说明。几何部分内容主要集中在顶点着色器上，我们来稍微看一眼，  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p14.png" class="">  
<p>与传统算法相同，使用了3个矩阵来实现变化，也就是说这个项目主要是使用的矩阵与传统不同，来实现与传统不同的效果，我们可以在项目找到作者对此的解释  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p15.png" class="">  
<p>从中我们可以知道，作者只改变了视图矩阵和模型矩阵，这点也可以从代码中得到证实  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p16.png" class="">
<p>我们没有看到模型矩阵的传入，它实际是在Object的绘制中确定，Mesh的绘制中传入GPU的  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p17.png" class="">  
<p>实际上，Object包含的是点集，表示一个模型，Mesh才是实际完成每个点绘制的，其实在这里就已经发现了一个项目问题，我们先推后一下，回到怎么确定矩阵的问题上来。<br>传统的模型矩阵主要包含位置(平移)、旋转和缩放的信息，并且在矩阵上也有一定的规律，平移信息位于矩阵右上3×1里面，如上图的p(vert)，旋转和缩放位于左上3×3里面，如上图的R(obj)，从如下代码  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p18.png" class="">  
<p>我们可以知道，这个项目其实就是让R多乘了一个3×3的矩阵S，而这个S被作者称为度规，对每点通过不同世界的metric来得到，值得注意作者的这个项目有好几个不同的世界。理论上来说，每点的S矩阵应该是不同的，但作者让每个Object的所有点都使用center点所对应的S，这就是我之前所说的可能问题。<br>对于视图矩阵，一般只有平移和旋转，分别表示相机的位置和朝向，由于朝向产生的方式有几种，所以一般分开进行相乘，下面是欧式空间下的生成方法  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p19.png" class="">  
<p>其中P是相机的位置，R、U、D分别表示右向量、上向量和朝向向量，它们可以组成一个正交标架，即坐标系，由线性代数的知识可以知道，只要像上面一样一排列，就可以实现世界坐标向相机坐标的转化了，而平常对相机的移动，可以通过位置向量加上相应的向量来实现，十分方便，如果要实现旋转的话，先看看这个项目  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p20.png" class="">  
<p>在UpdateDirection里面，我们看到一个矩阵Rotation，直接拿出来就可以实现我们平常的旋转了。而在这个项目了，我们发现，与Object类似，相机也同样是在旋转部分乘上这点的S矩阵。而在这个项目中，视图矩阵并不是作者所展示的那样有三个部分，在上面的getView可以看到，最右边矩阵m1是相机位置，不过多进行了一个叫regulariaze的不明操作，这个等下讲，而m2显然不是作者图给出的那样，在getView中可以看到结果是T*G在3×3部分的转置，在UpdateDirection可以看到T是S矩阵与旋转矩阵R乘积后的转置，而S与G的差别只是是否进行了施密特正交化，化简后是G的转置乘R乘T，所以此项目视图矩阵的差别就是旋转矩阵进行了一次相和变换，而且两个矩阵还差了个正交化，下面是作者在另一篇文章中的设想  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p21.png" class="">  
<p>这倒是符合代码中所写的那样，当然乱七八糟的，我看不懂，大致是前半将如何实现lookat，后部分说明为啥需要S和G，总之不明前后关系和内容。要不我们先来看看这个相机的移动吧，这是代码  </p>
<img src="/archives/2022-02-24-%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7%E6%8E%A2%E7%A9%B6/p22.png" class="">  
<p>首先它取出前后两个不同位置的矩阵S1和S2，一系列复杂操作得到Rotation，更新paraPos和T，但是这都不重要，虽然在Engine里先更新方向在更新位置，但是对于位置长期传入的是零，移动后占主导的仍然是方向更新，所以这里面真正起作用的就paraPos的更新，移动du然后regularize一次。</p>
<h3 id="项目总结"><a href="#项目总结" class="headerlink" title="项目总结"></a>项目总结</h3><p>至此我们将整个项目的结构看完了，有几个疑点，首先最开始的物品坐标指的是什么，是曲纹坐标，还是参数坐标，还是欧式坐标。我们稍微解释这三个坐标的区别，4维空间中的3维流形，有可以由三个参数确定，无任何限制时，这三个参数就是所决定点的参数坐标，而参数如果正好是测地线的弧长参数，就称为曲纹坐标，而在4维空间中的坐标就称为欧式坐标。显然坐标只有三个参数，不可能是最后一种，从WorldExample里计算度规(我喜欢叫做度量张量)的方法可以看到，并没有选择弧长参数，只是直接拿常见的一般方程来进行计算，其实这样选择的坐标是不符合要求的。而regularize只是单纯执行取余，比如在球面上绕一圈回到原点，在视频演示里也说了一种所谓的循环空间，就是这么来的。回到渲染流程上来，让模型矩阵莫名地乘以一个度量，实在不知道有什么用处，度量张量的核心作用是确定微分长度的，要乘也是要乘以位置的变化，这么说起来，它给的错误局部渲染图确实是这么写的，但代码里却又和这没什么关系，相机部分也懒得继续说了。总得来讲，我认为它只是玩了一些数字魔法，随便乱乘得出了一些奇妙的效果，再配上非欧几何之类的公式计算，使它看起来是如此的合理。</p>
<h1 id="非欧几何渲染"><a href="#非欧几何渲染" class="headerlink" title="非欧几何渲染"></a>非欧几何渲染</h1><p>从我的角度来看，非欧几何渲染是否可能取决你到底怎么看待它。如果只是要反直觉的话，前面两个项目其实都是可以的，而且后面一个项目还会更加的真实一些。渲染的核心几何元素是点和线，几何的核心元素也是点和线，如果单纯看着我们的屏幕，把很直的线当直线，我们永远只能看到欧式几何，如果你愿意把曲线当直线，当然就可以看到符合非欧几何的现象了，但是从OpenGL的渲染流程来看，直线变曲线并非可能的事，除非每条直线你都愿意给足够多的点，这主要是针对一些不太均匀的空间，每点有着不同的度量张量。要知道我们只能看到欧式空间，除非高一些维度做投影，这里我要提一下Whitney浸入定理，它其实是有定量关系的2维流形可以浸入3维欧式空间，而3维流形则最少要浸入5维欧式空间，对于只使用4个分量的OpenGL其实是不够的，但是浸入这回事，与单纯将4维欧式空间中的3维流形与3维欧式空间做对应，还是有所不同的，不过它们是否能形成对应，我目前没有看到定理可以表明这件事情。<br>总结一下就是，我并不相信非欧几何渲染的存在，因为你无法改变看到的空间的欧几里得性，这时你会不会又要和我扯广义相对论，我也不知道怎么反驳，其实比起这个，我更相信非欧几何可视化这件事，确实有人做过这件事，详细可以看<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=zQo_S3yNa2w">这个</a>。而且在微分几何的道路上，还有好多需要学的东西，流形一个重要的部分就是局部欧式化，为什么欧式空间如此重要，其实我认为的实情是只有通过欧式空间才能认识这些非欧空间，因为计算怎么看都是来自欧式空间中的R，太复杂了，我永远也不会想明白的。<br>非欧几何渲染的可能性即是数字魔法。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%B8%B2%E6%9F%93/">渲染</a><a class="post-meta__tags" href="/tags/%E5%87%A0%E4%BD%95/">几何</a></div><div class="post_share"></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">逯晓零</div><div class="author-info__description">我喜欢简洁，仅此而已。</div></div><div class="card-info-data site-data is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">65</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95"><span class="toc-number">1.</span> <span class="toc-text">非欧几何</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E9%A1%B9%E7%9B%AE%E5%AE%9E%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">两个项目实例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE1"><span class="toc-number">2.1.</span> <span class="toc-text">项目1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE2"><span class="toc-number">2.2.</span> <span class="toc-text">项目2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenGL%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.1.</span> <span class="toc-text">OpenGL渲染流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E7%B3%BB%E7%BB%9F"><span class="toc-number">2.2.2.</span> <span class="toc-text">坐标系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%B5%85%E6%9E%90"><span class="toc-number">2.2.3.</span> <span class="toc-text">项目浅析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93"><span class="toc-number">2.2.4.</span> <span class="toc-text">项目总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%9E%E6%AC%A7%E5%87%A0%E4%BD%95%E6%B8%B2%E6%9F%93"><span class="toc-number">3.</span> <span class="toc-text">非欧几何渲染</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2023-11-01-%E6%9D%82%E8%B0%88%EF%BC%9A2023-11-01/" title="杂谈：2023-11-01">杂谈：2023-11-01</a><time datetime="2023-11-01T00:07:17.000Z" title="发表于 2023-11-01 08:07:17">2023-11-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2023-10-01-%E6%9D%82%E8%B0%88%EF%BC%9A2023-10-01/" title="杂谈：2023.10.01">杂谈：2023.10.01</a><time datetime="2023-10-01T09:15:46.000Z" title="发表于 2023-10-01 17:15:46">2023-10-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2023-09-03-%E6%88%91%E8%BF%98%E6%83%B3%E5%81%9A%E7%9A%84%E4%BA%8B/" title="我还想做的事">我还想做的事</a><time datetime="2023-09-02T23:41:56.000Z" title="发表于 2023-09-03 07:41:56">2023-09-03</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 逯晓零</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div></div></body></html>