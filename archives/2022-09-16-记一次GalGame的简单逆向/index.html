<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>记一次GalGame的简单逆向 | 虚空之地</title><meta name="keywords" content="galgame,逆向"><meta name="author" content="逯晓零"><meta name="copyright" content="逯晓零"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="起因学习累了，放送一下，看看书，玩玩游戏是很正常的事情，但是呢！有些游戏就是让人十分的不爽，比如下面这个    这是我目前见过汉化最糟糕的游戏了，没有之一，时不时蹦出日语还不是事情，结合前后文和日语基础还是看得懂的，但后面莫名其妙出现的“第三种语言”——乱码，就真的令人十分难受了，再加上这游戏的强制缩放屏幕，搞得一天的好心情都没了，所以我决定来破解它。既然如此我们要破解什么呢？我个人猜测，后面的乱">
<meta property="og:type" content="article">
<meta property="og:title" content="记一次GalGame的简单逆向">
<meta property="og:url" content="http://example.com/archives/2022-09-16-%E8%AE%B0%E4%B8%80%E6%AC%A1GalGame%E7%9A%84%E7%AE%80%E5%8D%95%E9%80%86%E5%90%91/index.html">
<meta property="og:site_name" content="虚空之地">
<meta property="og:description" content="起因学习累了，放送一下，看看书，玩玩游戏是很正常的事情，但是呢！有些游戏就是让人十分的不爽，比如下面这个    这是我目前见过汉化最糟糕的游戏了，没有之一，时不时蹦出日语还不是事情，结合前后文和日语基础还是看得懂的，但后面莫名其妙出现的“第三种语言”——乱码，就真的令人十分难受了，再加上这游戏的强制缩放屏幕，搞得一天的好心情都没了，所以我决定来破解它。既然如此我们要破解什么呢？我个人猜测，后面的乱">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-09-16T09:14:01.000Z">
<meta property="article:modified_time" content="2023-09-03T13:50:21.220Z">
<meta property="article:author" content="逯晓零">
<meta property="article:tag" content="galgame">
<meta property="article:tag" content="逆向">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/archives/2022-09-16-%E8%AE%B0%E4%B8%80%E6%AC%A1GalGame%E7%9A%84%E7%AE%80%E5%8D%95%E9%80%86%E5%90%91/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '记一次GalGame的简单逆向',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-03 21:50:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">65</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/articles/"><i class="fa-fw fa fa-book"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/dream/"><i class="fa-fw fa fa-lightbulb"></i><span> 往逝</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">虚空之地</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/articles/"><i class="fa-fw fa fa-book"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/dream/"><i class="fa-fw fa fa-lightbulb"></i><span> 往逝</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">记一次GalGame的简单逆向</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-16T09:14:01.000Z" title="发表于 2022-09-16 17:14:01">2022-09-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-03T13:50:21.220Z" title="更新于 2023-09-03 21:50:21">2023-09-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>13分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>学习累了，放送一下，看看书，玩玩游戏是很正常的事情，但是呢！有些游戏就是让人十分的不爽，比如下面这个</p>

<img align="center" src="./p0.png" />

<p>这是我目前见过汉化最糟糕的游戏了，没有之一，时不时蹦出日语还不是事情，结合前后文和日语基础还是看得懂的，但后面莫名其妙出现的“第三种语言”——乱码，就真的令人十分难受了，再加上这游戏的强制缩放屏幕，搞得一天的好心情都没了，所以我决定来破解它。既然如此我们要破解什么呢？我个人猜测，后面的乱码会不会是已经翻译的文本，因为GBK和UTF-8的编码不同导致封包后，一部分内容完好，另一部分乱码，基于这个猜测，我们来看看能不能把它还原回来。当然，事实到底如何呢？现在的我也不明白。</p>
<h1 id="学习"><a href="#学习" class="headerlink" title="学习"></a>学习</h1><p>既然要破解，第一步当然是学习了，我呢！实在不想再体验当初那种一步步读汇编码的痛苦精力了，这次我要站在巨人的肩膀上，在GalGame的破解方面技术是十分成熟的，这并不像我上次解包的那个游戏，基本没有人去研究，自然需要来消磨耐心了。破解的技术散布在各个论坛里，目前还活跃在国内的论坛，有看雪、吾爱等，甚至还有bilibili，首先是下面这位大佬的<a target="_blank" rel="noopener" href="https://space.bilibili.com/8144708">基础性视频</a>，当然讲得都比较简单，基本都是识别基本引擎，使用现成工具，和一些普通的调试技巧，但跟着做很容养成破解的勇气，所谓艺高人胆大就是这么一回事，exe直接改十六进制文件，说实在的，我平常都不敢这么干，我是很怕出现各种文件验证、地址错位等问题的，但在软电池Sdwrap过法那里，更是将勇气发挥到了极致，直接删十六进制文件的内容。以前的我真的没这样的勇气，要知道对于二进制文件而言是有严格的格式要求的，有时还需要统计字节数，如果是我，顶多就只敢修改资源文件，因为反汇编也不可能得到完全的原始汇编代码，更何况它肯定不可能来自汇编代码的编译，也就是我们勇气只止步在静态分析上，看看它到底怎么运行的，修改它的运行轨迹，重来没有想过。<br>接着是调试工具，我们不会使用ide，它胜于静态分析，取而代之的是Ollydbg和x64dbg，当然我主要使用后面这个，因为前面的这个界面有些不好看，不太喜欢，就目前来看，功能性上基本都差不多</p>

<img align="center" src="./p1.png" />

<p>想要学习软件的使用的话，本来应该去看官方提供的手册，但我们是什么人，学计算机的人，有些东西稍微瞟一眼就应该知道是做什么的，更何况我们还有源代码调试的经验</p>

<img align="center" src="./p2.png" />

<p>首先是区域1的“模块1:ntdll.dll”，它表示当前代码所在的文件部分是动态库内而不在主程序里，对于非主程序部分一般都是不考虑的，它属于系统代码，可以相应的系统API手册来看用法，没必要去读难理解的反汇编代码；接着是区域2的eip寄存器，它指向将要执行的代码，也就是当前调试到了代码哪里的意思；区域3有步进和步入两个操作，它们用来推进代码的执行步入是一行行执行，而步进则会对函数调用的代码跳转进去，如果对于某些函数的作用不清楚的话，则可以跳进去看看，对应到汇编代码就是“call+地址”；区域4则是显示CPU的寄存器参数，比如EAX、EBX之类的寄存器，还包括记录下一步代码地址的EIP指针和一些标志位ZF、PF等；区域5是stdcall即调用栈堆，表示call指令调用路径，此处可以约化深度，更详细的需要选项栏中的调用栈堆；区域6则进行内存的监控，但地址需要自己从运行内存中找，一般动态修改工具都是在这部分区域找到对应参数进行修改的，比如你在代码里申明<code>int i = 1</code>之类的就可以在里面找到；区域7是用来管理断点的，断点这玩意一般的调试都挺常见了，运行的时候我们一般不会从头一行行的到想调试的地方，而是通过在特定位置打断点，等程序运行到此处再调试。这样，其实我们对x64dbg当然基本界面就已经很熟了，当然如果你对程序的运行机制很了解的话，自然就知道它需要什么，它该是什么样，然顺便就在程序中找到了它的对应位置。<br>对于程序的基本机理不是很懂的话，可以看看这个大佬的<a target="_blank" rel="noopener" href="https://www.52pojie.cn/thread-1358649-1-1.html">新人破解教程</a>，他直接从汇编的角度来教新人，基本可以不需要开发的基础，直接从一些基本的汇编指令来理解程序和它的运行，还教授了调试工具的用法和一些实例，甚至还讲了jmp和call之类跳转指令的区别，真正的强者敢于面对复杂的汇编指令，并试图去寻找规律，从而破解它，实在是令人敬佩。当然，调试还有一个更高的境界就是代码注入，本质和Chrome浏览器那个执行js代码的终端差不多，但是它是针对静态语言肯定比动态语言js困难很多，但仍有大佬开发了基本框架Frida，对于这玩意，因为知道它的原理，想要研究还是可以研究的，但因为基本用不到也就深入研究的必要了，只能说需要多少就学多少，不然太容易忘记了，就白学了。说了这么的学习的东西，接下来该回归现实了，我们研究的这个游戏不归属上面大佬所说的任何一个GalGame引擎，好像就解包不了了得自己研究，但事实却是，我们的GARbro资源解码收录器的数据库实在太强大了，还是把这个游戏资源解码方式给收录了进去</p>

<img align="center" src="./p3.png" />

<p>自然地，资源解码就不在考虑的范围内，当然这玩意也不是万能的，像下面这个游戏</p>

<img align="center" src="./p4.png" />

<p>格式包装方式虽然是已知的，但对应的加密方式并不在数据库内，对于这样的资源解包就得亲自去分析汇编代码了。</p>
<h1 id="游戏初探索"><a href="#游戏初探索" class="headerlink" title="游戏初探索"></a>游戏初探索</h1><p>接着我们来仔细研究一下这个游戏，资源结构如下</p>

<img align="center" src="./p5.png" />

<p>其中ini是明文配置文件，txt是开源使用协议，movie是游戏的OP，save是游戏存档，sfa16.exe是原始的程序，sfa16_cn.exe.exe是汉化后的程序，aos是可以被GARbro解包的资源文件，其中的scr就是我们汉化的核心，剧本文件了，通过简单的解包</p>

<img align="center" src="./p6.png" />

<p>我们发现游戏资源是以日语形式存在的，也就是说这些数据是给原始程序使用的，那么我们的汉化跑哪里去了呢？这时我们注意到sfa16_cn的内存比原程序大了几倍，这意味着汉化脚本应该在程序里面，没办法了，只能先动态调试一下了，首先我们将程序运行起来</p>

<img align="center" src="./p7.png" />

<p>我们想要干嘛呢？在运行内存中找到这句对话，并顺手找到脚本所在的地址，从而看看改后的剧本长什么样，我们对内存进行特征匹配收索</p>

<img align="center" src="./p8.png" />

<p>我们可以直接在GBK编码中输入汉字，程序会自动转化内存中的十六进制编码形式，结果有很多个，主要是这句话可以出现在好多地方，我们最后选择了两处</p>

<img align="center" src="./p9.png" />

<p>上面是这句话所在的内存地址，大概在0xAB95FE0处，而下面的则是脚本读取后所在的缓存地址，大概在0x2C1014D处，值得注意地是这些都是程序运行的虚拟地址，在主程序的十六进制文件中是找不到的。我们随便跳点剧情，可以看到</p>

<img align="center" src="./p10.png" />

<p>运行结果如我们所想，所以猜想大概率是正确的，我们来监视一下内存2，它包含了对话的主要内容，先看看日语处的情况</p>

<img align="center" src="./p11.png" />

<p>和所想基本没有区别，即所显示的文本GBK下的日语，接着看看我们主要研究的乱码部分</p>

<img align="center" src="./p12.png" />

<p>在GBK下内存数据和显示的是一样的，那么乱码的原因如我们之前所想的那样吗？可惜并非如此</p>

<img align="center" src="./p13.png" />

<p>在Shift_JIS编码下显示正常，这意味什么呢？这意味着汉化组没有汉化这部分内容，而且对于这部分日语还没有转化为GBK编码，所以在同一套GBK体系读取下，被转化的日语被读了出来，没被转化的部分被读成了乱码。基于这样的事实，我们一开始的目的看样子是没办法完成了，本来就没有汉化也就没有修复成中文的说法了，但是像这样的东西留着收藏库里总觉得不是很舒服，所以我们有了一个新的目标，乱码转日语，并配上机翻。</p>
<h1 id="汉化分析"><a href="#汉化分析" class="headerlink" title="汉化分析"></a>汉化分析</h1><p>要想完成我们的新目标，就需要知道汉化补丁是怎么产生的。首先我们注意到这样一个事实</p>

<img align="center" src="./p14.png" />

<p>汉化补丁的函数导入表明显比原始程序的导入表小可好多，这意味着汉化补丁被加壳了，但这并不是那种防止破解的加壳，想想就知道，本身就是搞破解的，还会去加密吗？我们使用查壳工具来一探究竟</p>

<img align="center" src="./p15.png" />

<p>原始程序没有任何加密，而汉化补丁使用了MoleBox，这是window的一个资源打包工具，随便使用一个程序就轻松地把它解开了</p>

<img align="center" src="./p16.png" />

<p>解包后的exe与原程序的大小基本一致，这里我们稍微提一下window的资源查找机制，当代码中查找当前目录中的文件时，会优先看exe是否是打包型资源，并在里面进行查找，没有的话才会查找当前实际的目录。正因如此，我们就会见到两种类型的程序，一个很大的exe，又或者是exe带了一堆dll和资源文件，当然了单文件的时候也有可能是它本身没有依赖。这种资源打包机制的一个作用就是PC程序安装，安装包就是资源打包型的exe，一部分是配置代码，另一部分则是作为资源的主程序，运行过程就是将exe内的资源复制到安装路径，并进行一些必要的配置操作，像修改注册表之类的事。而我们则是利用它来实现汉化补丁与日语原版的共存，运行原版时它读取路径下的原版资源，而运行补丁的时候，但遇到汉化文本时优先读取exe内的汉化资源，而对于exe内没有的cg之类的，则进一步读取当前的目录，从而达到对于非汉化资源读取共同部分，而汉化资源读取各自部分的目的。当然了，直接改日语的资源也是可以达到汉化的目的的，但总会给强迫症一种不是很完美的感觉。<br>汉化exe和原版exe内存虽然接近，但仍有较大差别，所以肯定被改过来，我们看看到底被改了什么，在此之前我们先将_extracted里的文件移出来，让汉化补丁读取到它，你可能会有疑问，为什么同样是目录下的资源文件，却优先读取汉化补丁呢？这其实游戏通常的开发习惯有关，进行调试的时候，我们一般都希望是明文，这样便于修改，脚本游戏也是类似的，但存在封包资源和解包资源，优先读取解包资源，利用这一点很多游戏有衍生出来patch即补丁机制</p>

<img align="center" src="./p17.png" />

<p>经过不断实践，我们发现游戏主要改了几个地方，首先是图片区，在片头的第二张里面换成了汉化组的信息，还有一些基础的UI，这些直接在补丁里添加即可，并不困难</p>

<img align="center" src="./p18.png" />

<p>当然格式最后保持一致，因为大多游戏都是文件名加后缀识别文件的，后缀不同有可能会读取不到；然后是菜单的汉化，它属于window内置API，可以十分容易的提取处配置文件并修改</p>

<img align="center" src="./p19.png" />

<p>通过探索我们发现有两个一样的menu，那么游戏读取的是哪个呢？只要制造差异就行了，像下面这样修改两个配置文件</p>

<img align="center" src="./p20.png" />

<p>封包后并运行可以发现，下面结果</p>

<img align="center" src="./p21.png" />

<p>所以游戏选择的第二个菜单，这也是汉化组所选择的那一个；接着应该是编码的修改，原始游戏使用Shift_JS，而修改后的使用GBK，这个可以通过跟踪CreateFontXXX之类的函数来实现，因为大部分游戏都是通过这种系统API方式来创建字体的</p>

<img align="center" src="./p22.png" />

<p>在调用的参数中，我们发现字体编码对应的16进制代码页是86，也就是GBK，而原来的游戏可以发现是80，即对应Shift_JIS，如我们所预料</p>

<img align="center" src="./p23.png" />

<p>最后一个是汉化的脚本，原来游戏对应的是scr.aos加内部的.scr文件</p>

<img align="center" src="./p24.png" />

<p>如果对应到非封包资源理应是scr/+.scr，但它却是tst/+.txt文件，注意到两者长度一致，所以大概率是改了16进制文件进行重定向，通过16对比，我们可以发现修改的地方</p>

<img align="center" src="./p25.png" />

<p>首先我们可以猜出，游戏对脚本资源的读取顺序应该是，<code>txt/%s.txt</code>、<code>scr/%s.scr</code>和<code>%s.scr</code>，其中的<code>%s</code>应该是占位符用来表示要读取的脚本的名字，而原始的读取方式应该是第二种，破解则是针对第一种，大概是用来测试的情况，将原来的<code>txt/%s.txt</code>改成了汉化所对应的<code>tst/%s.txt</code>，为什么可以这么猜？只能说这是实际测试出来的结果，只要敢于尝试就能猜出来，实在不行的话，就定位去读汇编代码吧</p>

<img align="center" src="./p26.png" />

<p>反正就是这么一回事，分析什么的也懒得做了，至于其它细微的区别都是因为打包软件的不同所导致的，本质运行上是没有差别的，最后我们来分析乱码的根本原因在哪里？对比原版和汉化的，可以发现</p>

<img align="center" src="./p27.png" />

<p>汉化提取的资源少了很多，而少的那部分却包含了文本剧情，这意味着汉化补丁在运行的时候，对于这部分剧本找不到脚本，只能去读取原始的资源，而原始的资源是Shift_JIS编码，读取的却是GBK编码，从而导致了最终的乱码，一切的原因都已经摸清，接着就是改造了。</p>
<h1 id="游戏改造"><a href="#游戏改造" class="headerlink" title="游戏改造"></a>游戏改造</h1><p>我们预计完成两个改造，首先提取所有的包含剧情的脚本，然后移动到tst内，对于出现的跳过即可，然后时间排序，对于刚引入的资源进行编码转化，这样进行一次封包，从而得到中日混合的游戏，至少不包含乱码了。接着我们对日语部分进行机翻，我不是很喜欢这个游戏，所以也懒得去润色或自己翻译了，这样完成了第二次封包，拿到一个中文的补丁，这样我们的目的和任务就全部都达成了。首先，我们查出，包含剧情且没被汉化的有下面这些</p>

<img align="center" src="./p28.png" />

<p>转码以后，值得注意的是这里的转码并不是读取以后改个编码，而是以Shift_JIS读取文本形成通用编码的中间体，再以GBK编码进行数据保存的意思，然后我们进行第一次打包</p>

<img align="center" src="./p29.png" />

<p>然后运行起来，在原来乱码的地方已经变回了正常编码</p>

<img align="center" src="./p30.png" />

<p>但其实我们还发现了一个问题，有些选项是日语，而有些选项却是乱码，其实有些选项也包含了文本</p>

<img align="center" src="./p31.png" />

<p>所以对于这类脚本，也不得不包含进汉化补丁里面，经过排查，我们找到了所有需要转码的选项脚本</p>

<img align="center" src="./p32.png" />

<p>最后进行同样的操作，校验一遍后没有遇到什么大问题，于是得到了第一个混合包，<a href="./sfa16_cn_jp.exe">中日混合版</a>，接着我们直接对其它部分用百度翻译，突然发现机翻也没那么好用，它会直接改变脚本的结构，还得一句句复制机翻，呵呵，算了吧，反正我也不怎么喜欢这个游戏，同一题材的3days和euphoria的剧情明显优秀多了，就让有志者去翻译吧，而且日语我又不是看不懂，下面是<a href="./res.zip">解包资源</a>，将里面没汉化的脚本进行汉化，再用随便一个打包软件，比如EnigmaVirtualBox，就能制成汉化补丁了。<br>就说这么多吧，其实这次的破解实在没什么惊艳的地方，游戏本身就比较老是原因之一，破解工具比较齐全也是一个原因，但作为一个学习的记录合格的，不能因为简单就小看别人吧，好歹人家也是努力过的。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/galgame/">galgame</a><a class="post-meta__tags" href="/tags/%E9%80%86%E5%90%91/">逆向</a></div><div class="post_share"></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">逯晓零</div><div class="author-info__description">我喜欢简洁，仅此而已。</div></div><div class="card-info-data site-data is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">65</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B5%B7%E5%9B%A0"><span class="toc-number">1.</span> <span class="toc-text">起因</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0"><span class="toc-number">2.</span> <span class="toc-text">学习</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E5%88%9D%E6%8E%A2%E7%B4%A2"><span class="toc-number">3.</span> <span class="toc-text">游戏初探索</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B1%89%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">汉化分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E6%94%B9%E9%80%A0"><span class="toc-number">5.</span> <span class="toc-text">游戏改造</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2025-05-31-%E5%B9%B3%E5%87%A1%E7%9A%84%E6%84%9F%E5%8A%A8/" title="平凡的感动">平凡的感动</a><time datetime="2025-05-31T12:20:20.000Z" title="发表于 2025-05-31 20:20:20">2025-05-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2025-04-30-%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0%E4%B9%8B%E5%AD%97%E7%AC%A6%E4%B8%B2/" title="编程手记之字符串">编程手记之字符串</a><time datetime="2025-04-30T05:53:40.000Z" title="发表于 2025-04-30 13:53:40">2025-04-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2025-04-21-%E5%B7%B2%E5%8E%BB%E7%9A%84%E6%97%A0%E9%A2%98/" title="已去的无题">已去的无题</a><time datetime="2025-04-21T09:58:59.000Z" title="发表于 2025-04-21 17:58:59">2025-04-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By 逯晓零</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div></div></body></html>