<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>编程手记之渲染游记 | 虚空之地</title><meta name="keywords" content="渲染,编程手记"><meta name="author" content="逯晓零"><meta name="copyright" content="逯晓零"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="“铁打的图形，流水的API。”最近闲来无事，想去学习一下各种底层的渲染API，这一学就是好几天，而且我只画出了一个三角形。我感慨颇多故有以下这篇文章，我不会讲图形，只是从开发者的角度说说感受。 OpenGL源代码 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051">
<meta property="og:type" content="article">
<meta property="og:title" content="编程手记之渲染游记">
<meta property="og:url" content="http://example.com/archives/2022-01-17-%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0%E4%B9%8B%E6%B8%B2%E6%9F%93%E6%B8%B8%E8%AE%B0/index.html">
<meta property="og:site_name" content="虚空之地">
<meta property="og:description" content="“铁打的图形，流水的API。”最近闲来无事，想去学习一下各种底层的渲染API，这一学就是好几天，而且我只画出了一个三角形。我感慨颇多故有以下这篇文章，我不会讲图形，只是从开发者的角度说说感受。 OpenGL源代码 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2022-01-17T14:34:46.000Z">
<meta property="article:modified_time" content="2023-09-03T13:50:20.712Z">
<meta property="article:author" content="逯晓零">
<meta property="article:tag" content="渲染">
<meta property="article:tag" content="编程手记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/archives/2022-01-17-%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0%E4%B9%8B%E6%B8%B2%E6%9F%93%E6%B8%B8%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '编程手记之渲染游记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-03 21:50:20'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">65</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/articles/"><i class="fa-fw fa fa-book"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/dream/"><i class="fa-fw fa fa-lightbulb"></i><span> 往逝</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">虚空之地</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/articles/"><i class="fa-fw fa fa-book"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/dream/"><i class="fa-fw fa fa-lightbulb"></i><span> 往逝</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">编程手记之渲染游记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-17T14:34:46.000Z" title="发表于 2022-01-17 22:34:46">2022-01-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-03T13:50:20.712Z" title="更新于 2023-09-03 21:50:20">2023-09-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>32分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>“铁打的图形，流水的API。”最近闲来无事，想去学习一下各种底层的渲染API，这一学就是好几天，而且我只画出了一个三角形。我感慨颇多故有以下这篇文章，我不会讲图形，只是从开发者的角度说说感受。</p>
<h1 id="OpenGL"><a href="#OpenGL" class="headerlink" title="OpenGL"></a>OpenGL</h1><p>源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;glad/glad.h&gt;</span><br><span class="line">#include &lt;GLFW/glfw3.h&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">int width = 1280;</span><br><span class="line">int height = 720;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib, &quot;glfw3.lib&quot;)</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    //window</span><br><span class="line">	glfwInit();</span><br><span class="line">    auto window = glfwCreateWindow(width, height, &quot;window&quot;, nullptr, nullptr);</span><br><span class="line">    glfwMakeContextCurrent(window);</span><br><span class="line">    gladLoadGLLoader((GLADloadproc)glfwGetProcAddress);</span><br><span class="line">    glViewport(0, 0, width, height);</span><br><span class="line"></span><br><span class="line">    //data</span><br><span class="line">    GLuint vertex_array_object;</span><br><span class="line">    glGenVertexArrays(1, &amp;vertex_array_object);</span><br><span class="line">    glBindVertexArray(vertex_array_object);</span><br><span class="line"></span><br><span class="line">    const float triangle[] = &#123;</span><br><span class="line">         -0.5f, -0.5f, 0.0f,</span><br><span class="line">          0.5f, -0.5f, 0.0f,</span><br><span class="line">          0.0f,  0.5f, 0.0f</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    GLuint vertex_buffer_object;</span><br><span class="line">    glGenBuffers(1, &amp;vertex_buffer_object);</span><br><span class="line">    glBindBuffer(GL_ARRAY_BUFFER, vertex_buffer_object);</span><br><span class="line">    glBufferData(GL_ARRAY_BUFFER, sizeof(triangle), triangle, GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    unsigned int indices[] = &#123;</span><br><span class="line">        0, 1, 2</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    GLuint element_buffer_object;</span><br><span class="line">    glGenBuffers(1, &amp;element_buffer_object);</span><br><span class="line">    glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, element_buffer_object);</span><br><span class="line">    glBufferData(GL_ELEMENT_ARRAY_BUFFER, sizeof(indices), indices, GL_STATIC_DRAW);</span><br><span class="line"></span><br><span class="line">    glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 3 * sizeof(float), (void*)0);</span><br><span class="line">    glEnableVertexAttribArray(0);</span><br><span class="line"></span><br><span class="line">    //shader</span><br><span class="line">    const char* vertex_shader_source =</span><br><span class="line">        &quot;#version 330 core\n&quot;</span><br><span class="line">        &quot;layout (location = 0) in vec3 aPos;\n&quot;</span><br><span class="line">        &quot;void main()\n&quot;</span><br><span class="line">        &quot;&#123;\n&quot;</span><br><span class="line">        &quot;    gl_Position = vec4(aPos, 1.0);\n&quot;</span><br><span class="line">        &quot;&#125;\n\0&quot;;</span><br><span class="line">    const char* fragment_shader_source =</span><br><span class="line">        &quot;#version 330 core\n&quot;</span><br><span class="line">        &quot;out vec4 FragColor;\n&quot;</span><br><span class="line">        &quot;void main()\n&quot;</span><br><span class="line">        &quot;&#123;\n&quot;</span><br><span class="line">        &quot;    FragColor = vec4(1.0f, 1.0f, 1.0f, 1.0f);\n&quot;</span><br><span class="line">        &quot;&#125;\n\0&quot;;</span><br><span class="line"></span><br><span class="line">    int vertex_shader = glCreateShader(GL_VERTEX_SHADER);</span><br><span class="line">    glShaderSource(vertex_shader, 1, &amp;vertex_shader_source, NULL);</span><br><span class="line">    glCompileShader(vertex_shader);</span><br><span class="line"></span><br><span class="line">    int fragment_shader = glCreateShader(GL_FRAGMENT_SHADER);</span><br><span class="line">    glShaderSource(fragment_shader, 1, &amp;fragment_shader_source, NULL);</span><br><span class="line">    glCompileShader(fragment_shader);</span><br><span class="line"></span><br><span class="line">    int shader_program = glCreateProgram();</span><br><span class="line">    glAttachShader(shader_program, vertex_shader);</span><br><span class="line">    glAttachShader(shader_program, fragment_shader);</span><br><span class="line">    glLinkProgram(shader_program);</span><br><span class="line"></span><br><span class="line">    glDeleteShader(vertex_shader);</span><br><span class="line">    glDeleteShader(fragment_shader);</span><br><span class="line"></span><br><span class="line">    //draw</span><br><span class="line">    glClearColor(0.0f, 0.0f, 0.0f, 1.0f);</span><br><span class="line">    glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line"></span><br><span class="line">    glDrawElements(GL_TRIANGLES, 3, GL_UNSIGNED_INT, 0);</span><br><span class="line"></span><br><span class="line">    glfwSwapBuffers(window);</span><br><span class="line"></span><br><span class="line">    //event</span><br><span class="line">    while (!glfwWindowShouldClose(window)) &#123;</span><br><span class="line">        glfwPollEvents();</span><br><span class="line">    &#125;</span><br><span class="line">    glfwTerminate();</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果  </p>
<img src="/archives/2022-01-17-%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0%E4%B9%8B%E6%B8%B2%E6%9F%93%E6%B8%B8%E8%AE%B0/p1.png" class="">  
<p>这里的OpenGL是现代版的，包含Buffer和Shader，并不是那种老式的<code>glBegin</code>和<code>glEnd</code>。注意我们写得API都是极度简化的，比如没有包含调试相关代码，所以千万别学啊，不然会难受的要死，特别是后面讲的更现代的API。OpenGL有点像第三方API，代码实现是在显卡驱动里面，但我们的Windows系统更偏爱的是它自己的DirectX，所以系统提供的gl库和接口都太老了，似乎还停留在1.X。所以我们需要一些辅助库来从驱动中拉出相关函数，当然也可以通过名称手动拉出函数指针，不过我们还是使用已经写好的工具比较好，这就是我们的glad。glfw主要提供窗口上下文，至于window自带的窗口API其实能用，就是十分麻烦，还没有跨平台性。还有一件值得说的是，比较新的glfw里已经集成了glad的功能，只不过初始化使用的是<code>gladLoadGL</code>而不是原来的<code>gladLoadGLLoader</code>，还有头文件是<code>glad/gl.h</code>，从目前的实际开发来看，两者的功能基本一样。值得注意的是我这里链接库的时候使用了<code>#pragma</code>，这可别用上瘾了，它没有跨平台性，如果不跨平台还不如用DirectX，我这里用这个主要是防止链接出问题，32位和64位需要链接两个不同的库，干脆直接在代码里链接算了。</p>
<h1 id="DirectX11"><a href="#DirectX11" class="headerlink" title="DirectX11"></a>DirectX11</h1><p>源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line">#include &lt;wrl.h&gt;</span><br><span class="line">#include &lt;d3d11.h&gt;</span><br><span class="line">#include &lt;d3dcompiler.h&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib,&quot;d3d11.lib&quot;)</span><br><span class="line">#pragma comment(lib, &quot;D3DCompiler.lib&quot;)</span><br><span class="line"></span><br><span class="line">int width = 720;</span><br><span class="line">int height = 540;</span><br><span class="line"></span><br><span class="line">int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR lpCmdLine, int nCmdShow)</span><br><span class="line">&#123;</span><br><span class="line">	// window</span><br><span class="line">	WNDCLASSEX wc = &#123; 0 &#125;;</span><br><span class="line">	wc.cbSize = sizeof(wc);</span><br><span class="line">	wc.style = CS_OWNDC;</span><br><span class="line">	wc.lpfnWndProc = DefWindowProc;</span><br><span class="line">	wc.cbClsExtra = 0;</span><br><span class="line">	wc.cbWndExtra = 0;</span><br><span class="line">	wc.hInstance = hInstance;</span><br><span class="line">	wc.hIcon = nullptr;</span><br><span class="line">	wc.hCursor = nullptr;</span><br><span class="line">	wc.hbrBackground = nullptr;</span><br><span class="line">	wc.lpszMenuName = nullptr;</span><br><span class="line">	wc.lpszClassName = TEXT(&quot;dx11Win&quot;);</span><br><span class="line">	wc.hIconSm = nullptr;</span><br><span class="line">	RegisterClassEx(&amp;wc);</span><br><span class="line"></span><br><span class="line">	HWND hWnd = CreateWindow(L&quot;dx11Win&quot;, L&quot;DirectX11Window&quot;, WS_CAPTION | WS_MINIMIZEBOX | WS_SYSMENU, CW_USEDEFAULT, CW_USEDEFAULT, width, height, nullptr, nullptr, hInstance, nullptr);</span><br><span class="line">	ShowWindow(hWnd, SW_SHOWDEFAULT);</span><br><span class="line"></span><br><span class="line">	//init</span><br><span class="line">	DXGI_SWAP_CHAIN_DESC sd = &#123;&#125;;</span><br><span class="line">	sd.BufferDesc.Width = width;</span><br><span class="line">	sd.BufferDesc.Height = height;</span><br><span class="line">	sd.BufferDesc.Format = DXGI_FORMAT_B8G8R8A8_UNORM;</span><br><span class="line">	sd.BufferDesc.RefreshRate.Numerator = 0;</span><br><span class="line">	sd.BufferDesc.RefreshRate.Denominator = 0;</span><br><span class="line">	sd.BufferDesc.Scaling = DXGI_MODE_SCALING_UNSPECIFIED;</span><br><span class="line">	sd.BufferDesc.ScanlineOrdering = DXGI_MODE_SCANLINE_ORDER_UNSPECIFIED;</span><br><span class="line">	sd.SampleDesc.Count = 1;</span><br><span class="line">	sd.SampleDesc.Quality = 0;</span><br><span class="line">	sd.BufferUsage = DXGI_USAGE_RENDER_TARGET_OUTPUT;</span><br><span class="line">	sd.BufferCount = 1;</span><br><span class="line">	sd.OutputWindow = hWnd;</span><br><span class="line">	sd.Windowed = TRUE;</span><br><span class="line">	sd.SwapEffect = DXGI_SWAP_EFFECT_DISCARD;</span><br><span class="line">	sd.Flags = 0;</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11Device&gt; pDevice;</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;IDXGISwapChain&gt; pSwap;</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11DeviceContext&gt; pContext;</span><br><span class="line">	D3D11CreateDeviceAndSwapChain(nullptr, D3D_DRIVER_TYPE_HARDWARE, nullptr, 0, nullptr, 0, D3D11_SDK_VERSION, &amp;sd, &amp;pSwap, &amp;pDevice, nullptr, &amp;pContext);</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11RenderTargetView&gt; pTarget;</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11Resource&gt; pBackBuffer;</span><br><span class="line">	pSwap-&gt;GetBuffer(0, __uuidof(ID3D11Resource), &amp;pBackBuffer);</span><br><span class="line">	pDevice-&gt;CreateRenderTargetView(pBackBuffer.Get(), nullptr, &amp;pTarget);</span><br><span class="line"></span><br><span class="line">	//data</span><br><span class="line">	const float vertices[] = &#123;</span><br><span class="line">		0.0f, 0.5f,</span><br><span class="line">		0.5f, -0.5f,</span><br><span class="line">		-0.5f, -0.5f</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11Buffer&gt; pVertexBuffer;</span><br><span class="line">	D3D11_BUFFER_DESC bd = &#123;&#125;;</span><br><span class="line">	bd.BindFlags = D3D11_BIND_VERTEX_BUFFER;</span><br><span class="line">	bd.Usage = D3D11_USAGE_DEFAULT;</span><br><span class="line">	bd.CPUAccessFlags = 0u;</span><br><span class="line">	bd.MiscFlags = 0u;</span><br><span class="line">	bd.ByteWidth = sizeof(vertices);</span><br><span class="line">	bd.StructureByteStride = 2 * sizeof(float);</span><br><span class="line">	D3D11_SUBRESOURCE_DATA pData = &#123;&#125;;</span><br><span class="line">	pData.pSysMem = vertices;</span><br><span class="line">	pDevice-&gt;CreateBuffer(&amp;bd, &amp;pData, &amp;pVertexBuffer);</span><br><span class="line"></span><br><span class="line">	const UINT stride = 2 * sizeof(float);</span><br><span class="line">	const UINT offset = 0u;</span><br><span class="line">	pContext-&gt;IASetVertexBuffers(0u, 1u, pVertexBuffer.GetAddressOf(), &amp;stride, &amp;offset);</span><br><span class="line"></span><br><span class="line">	const unsigned short indices[] =</span><br><span class="line">	&#123;</span><br><span class="line">		0, 1, 2</span><br><span class="line">	&#125;;</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11Buffer&gt; pIndexBuffer;</span><br><span class="line">	D3D11_BUFFER_DESC ibd = &#123;&#125;;</span><br><span class="line">	ibd.BindFlags = D3D11_BIND_INDEX_BUFFER;</span><br><span class="line">	ibd.Usage = D3D11_USAGE_DEFAULT;</span><br><span class="line">	ibd.CPUAccessFlags = 0u;</span><br><span class="line">	ibd.MiscFlags = 0u;</span><br><span class="line">	ibd.ByteWidth = sizeof(indices);</span><br><span class="line">	ibd.StructureByteStride = sizeof(unsigned short);</span><br><span class="line">	D3D11_SUBRESOURCE_DATA isd = &#123;&#125;;</span><br><span class="line">	isd.pSysMem = indices;</span><br><span class="line">	pDevice-&gt;CreateBuffer(&amp;ibd, &amp;isd, &amp;pIndexBuffer);</span><br><span class="line"></span><br><span class="line">	pContext-&gt;IASetIndexBuffer(pIndexBuffer.Get(), DXGI_FORMAT_R16_UINT, 0u);</span><br><span class="line"></span><br><span class="line">	//shader</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3DBlob&gt; pBlob;</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11PixelShader&gt; pPixelShader;</span><br><span class="line">	D3DReadFileToBlob(L&quot;PixelShader.cso&quot;, &amp;pBlob);</span><br><span class="line">	pDevice-&gt;CreatePixelShader(pBlob-&gt;GetBufferPointer(), pBlob-&gt;GetBufferSize(), nullptr, &amp;pPixelShader);</span><br><span class="line"></span><br><span class="line">	pContext-&gt;PSSetShader(pPixelShader.Get(), nullptr, 0u);</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11VertexShader&gt; pVertexShader;</span><br><span class="line">	D3DReadFileToBlob(L&quot;VertexShader.cso&quot;, &amp;pBlob);</span><br><span class="line">	pDevice-&gt;CreateVertexShader(pBlob-&gt;GetBufferPointer(), pBlob-&gt;GetBufferSize(), nullptr, &amp;pVertexShader);</span><br><span class="line"></span><br><span class="line">	pContext-&gt;VSSetShader(pVertexShader.Get(), nullptr, 0u);</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D11InputLayout&gt; pInputLayout;</span><br><span class="line">	const D3D11_INPUT_ELEMENT_DESC ied[] =</span><br><span class="line">	&#123;</span><br><span class="line">		&#123;&quot;POSITION&quot;, 0, DXGI_FORMAT_R32G32_FLOAT, 0, 0, D3D11_INPUT_PER_VERTEX_DATA, 0&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">	pDevice-&gt;CreateInputLayout(ied, 1u, pBlob-&gt;GetBufferPointer(), pBlob-&gt;GetBufferSize(), &amp;pInputLayout );</span><br><span class="line">	pContext-&gt;IASetInputLayout(pInputLayout.Get());</span><br><span class="line"></span><br><span class="line">	pContext-&gt;OMSetRenderTargets(1u, pTarget.GetAddressOf(), nullptr);</span><br><span class="line"></span><br><span class="line">	pContext-&gt;IASetPrimitiveTopology(D3D11_PRIMITIVE_TOPOLOGY_TRIANGLELIST);</span><br><span class="line"></span><br><span class="line">	D3D11_VIEWPORT vp;</span><br><span class="line">	vp.Width = width;</span><br><span class="line">	vp.Height = height;</span><br><span class="line">	vp.MinDepth = 0;</span><br><span class="line">	vp.MaxDepth = 1;</span><br><span class="line">	vp.TopLeftX = 0;</span><br><span class="line">	vp.TopLeftY = 0;</span><br><span class="line">	pContext-&gt;RSSetViewports(1u, &amp;vp);</span><br><span class="line"></span><br><span class="line">	//draw</span><br><span class="line">	const float color[] = &#123; 0.0f, 0.0f, 0.0f, 1.0f &#125;;</span><br><span class="line">	pContext-&gt;ClearRenderTargetView(pTarget.Get(), color);</span><br><span class="line">	pContext-&gt;DrawIndexed(3u, 0u, 0u);</span><br><span class="line">	pSwap-&gt;Present(1u, 0u);</span><br><span class="line"></span><br><span class="line">	//event</span><br><span class="line">	while (true)</span><br><span class="line">	&#123;</span><br><span class="line">		MSG msg;</span><br><span class="line">		while (PeekMessage(&amp;msg, nullptr, 0, 0, PM_REMOVE))</span><br><span class="line">		&#123;</span><br><span class="line">			TranslateMessage(&amp;msg);</span><br><span class="line">			DispatchMessage(&amp;msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>顶点着色器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">float4 main(float3 pos : POSITION) : SV_POSITION</span><br><span class="line">&#123;</span><br><span class="line">	return float4(pos.x, pos.y, pos.z, 1.0f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>像素(片段)着色器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">float4 main() : SV_TARGET</span><br><span class="line">&#123;</span><br><span class="line">	return float4(1.0f, 1.0f, 1.0f, 1.0f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果  </p>
<img src="/archives/2022-01-17-%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0%E4%B9%8B%E6%B8%B2%E6%9F%93%E6%B8%B8%E8%AE%B0/p2.png" class="">  
<p>我使用DirectX的第一感受就是，都是什么奇葩的API，都什么时代了，还用大写的函数，而且还非得给基本变量类型大写重新命名一遍，真的有必要吗？可能是我基本没接触过C++版的WinAPI的原因吧，因为大部分用的都是C#和.Net。还有就是这离谱的配置系统，使用结构体保存配置就算了，有些本身没配置必要的就不能给一个默认值嘛，不配置还会运行异常，说到这个，我使用的时候遇到的最多错误的就是，指针访问冲突，当然其实不算啥，主要这个配置系统牵一发而动全身，某处配置了，另一处就得和它对应。还有这离谱的事件管理，果然老就是老，一个窗口关闭，结束程序都那么麻烦，当然我没写就是了。其实啊，窗口系统是可以使用glfw的，不过对于窗口系统最后我们要完成的就是封装而已，何必再多一层glfw来封装，而且DirectX只能在windows上，跨平台也没有必要吧，嗯，总之，这只是一种思路而已。虽然看起来DirectX似乎不太比得上OpenGL，当然我不想说效率之类的，这没有比较的意义，单纯从开发者来看，DirectX提供提供了更加丰富的组件，但opengl还得依赖外部库，如数学运算的glm，同时对内存管理上，DirectX有自己的智能指针来管理COM对象，而对opengl则必需封装对应对象以后，写了对应析构函数之后，才能使用C++标准提供的智能指针来管理内存。OpenGL嘛，跨平台，写起来简单又优美，这就足够了。</p>
<h1 id="metal"><a href="#metal" class="headerlink" title="metal"></a>metal</h1><p>源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">@import simd;</span><br><span class="line">@import MetalKit;</span><br><span class="line"></span><br><span class="line">@interface AAPLRenderer : NSObject&lt;MTKViewDelegate&gt;</span><br><span class="line"></span><br><span class="line">- (nonnull instancetype)initWithMetalKitView:(nonnull MTKView *)mtkView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">typedef enum AAPLVertexInputIndex</span><br><span class="line">&#123;</span><br><span class="line">    AAPLVertexInputIndexVertices     = 0,</span><br><span class="line">    AAPLVertexInputIndexViewportSize = 1,</span><br><span class="line">&#125; AAPLVertexInputIndex;</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">    vector_float2 position;</span><br><span class="line">    vector_float4 color;</span><br><span class="line">&#125; AAPLVertex;</span><br><span class="line"></span><br><span class="line">@implementation AAPLRenderer</span><br><span class="line">&#123;</span><br><span class="line">    id&lt;MTLDevice&gt; _device;</span><br><span class="line"></span><br><span class="line">    id&lt;MTLRenderPipelineState&gt; _pipelineState;</span><br><span class="line"></span><br><span class="line">    id&lt;MTLCommandQueue&gt; _commandQueue;</span><br><span class="line"></span><br><span class="line">    vector_uint2 _viewportSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (nonnull instancetype)initWithMetalKitView:(nonnull MTKView *)mtkView</span><br><span class="line">&#123;</span><br><span class="line">    self = [super init];</span><br><span class="line">    if(self)</span><br><span class="line">    &#123;</span><br><span class="line">        NSError *error;</span><br><span class="line"></span><br><span class="line">        _device = mtkView.device;</span><br><span class="line"></span><br><span class="line">        id&lt;MTLLibrary&gt; defaultLibrary = [_device newDefaultLibrary];</span><br><span class="line"></span><br><span class="line">        id&lt;MTLFunction&gt; vertexFunction = [defaultLibrary newFunctionWithName:@&quot;vertexShader&quot;];</span><br><span class="line">        id&lt;MTLFunction&gt; fragmentFunction = [defaultLibrary newFunctionWithName:@&quot;fragmentShader&quot;];</span><br><span class="line"></span><br><span class="line">        MTLRenderPipelineDescriptor *pipelineStateDescriptor = [[MTLRenderPipelineDescriptor alloc] init];</span><br><span class="line">        pipelineStateDescriptor.label = @&quot;Simple Pipeline&quot;;</span><br><span class="line">        pipelineStateDescriptor.vertexFunction = vertexFunction;</span><br><span class="line">        pipelineStateDescriptor.fragmentFunction = fragmentFunction;</span><br><span class="line">        pipelineStateDescriptor.colorAttachments[0].pixelFormat = mtkView.colorPixelFormat;</span><br><span class="line"></span><br><span class="line">        _pipelineState = [_device newRenderPipelineStateWithDescriptor:pipelineStateDescriptor</span><br><span class="line">                                                                 error:&amp;error];</span><br><span class="line">                </span><br><span class="line">        NSAssert(_pipelineState, @&quot;Failed to create pipeline state: %@&quot;, error);</span><br><span class="line"></span><br><span class="line">        _commandQueue = [_device newCommandQueue];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)mtkView:(nonnull MTKView *)view drawableSizeWillChange:(CGSize)size</span><br><span class="line">&#123;</span><br><span class="line">    _viewportSize.x = size.width;</span><br><span class="line">    _viewportSize.y = size.height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)drawInMTKView:(nonnull MTKView *)view</span><br><span class="line">&#123;</span><br><span class="line">    static const AAPLVertex triangleVertices[] =</span><br><span class="line">    &#123;</span><br><span class="line">        // 2D positions,    RGBA colors</span><br><span class="line">        &#123; &#123;  250,  -250 &#125;, &#123; 1, 0, 0, 1 &#125; &#125;,</span><br><span class="line">        &#123; &#123; -250,  -250 &#125;, &#123; 0, 1, 0, 1 &#125; &#125;,</span><br><span class="line">        &#123; &#123;    0,   250 &#125;, &#123; 0, 0, 1, 1 &#125; &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    id&lt;MTLCommandBuffer&gt; commandBuffer = [_commandQueue commandBuffer];</span><br><span class="line">    commandBuffer.label = @&quot;MyCommand&quot;;</span><br><span class="line"></span><br><span class="line">    MTLRenderPassDescriptor *renderPassDescriptor = view.currentRenderPassDescriptor;</span><br><span class="line"></span><br><span class="line">    if(renderPassDescriptor != nil)</span><br><span class="line">    &#123;</span><br><span class="line">        id&lt;MTLRenderCommandEncoder&gt; renderEncoder =</span><br><span class="line">        [commandBuffer renderCommandEncoderWithDescriptor:renderPassDescriptor];</span><br><span class="line">        renderEncoder.label = @&quot;MyRenderEncoder&quot;;</span><br><span class="line"></span><br><span class="line">        [renderEncoder setViewport:(MTLViewport)&#123;0.0, 0.0, _viewportSize.x, _viewportSize.y, 0.0, 1.0 &#125;];</span><br><span class="line">        </span><br><span class="line">        [renderEncoder setRenderPipelineState:_pipelineState];</span><br><span class="line"></span><br><span class="line">        [renderEncoder setVertexBytes:triangleVertices</span><br><span class="line">                               length:sizeof(triangleVertices)</span><br><span class="line">                              atIndex:AAPLVertexInputIndexVertices];</span><br><span class="line">        </span><br><span class="line">        [renderEncoder setVertexBytes:&amp;_viewportSize</span><br><span class="line">                               length:sizeof(_viewportSize)</span><br><span class="line">                              atIndex:AAPLVertexInputIndexViewportSize];</span><br><span class="line"></span><br><span class="line">        [renderEncoder drawPrimitives:MTLPrimitiveTypeTriangle</span><br><span class="line">                          vertexStart:0</span><br><span class="line">                          vertexCount:3];</span><br><span class="line"></span><br><span class="line">        [renderEncoder endEncoding];</span><br><span class="line"></span><br><span class="line">        [commandBuffer presentDrawable:view.currentDrawable];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [commandBuffer commit];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>着色器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;metal_stdlib&gt;</span><br><span class="line"></span><br><span class="line">using namespace metal;</span><br><span class="line"></span><br><span class="line">#include &quot;AAPLShaderTypes.h&quot;</span><br><span class="line"></span><br><span class="line">struct RasterizerData</span><br><span class="line">&#123;</span><br><span class="line">    float4 position [[position]];</span><br><span class="line"></span><br><span class="line">    float4 color;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vertex RasterizerData</span><br><span class="line">vertexShader(uint vertexID [[vertex_id]],</span><br><span class="line">             constant AAPLVertex *vertices [[buffer(AAPLVertexInputIndexVertices)]],</span><br><span class="line">             constant vector_uint2 *viewportSizePointer [[buffer(AAPLVertexInputIndexViewportSize)]])</span><br><span class="line">&#123;</span><br><span class="line">    RasterizerData out;</span><br><span class="line"></span><br><span class="line">    float2 pixelSpacePosition = vertices[vertexID].position.xy;</span><br><span class="line"></span><br><span class="line">    vector_float2 viewportSize = vector_float2(*viewportSizePointer);</span><br><span class="line"></span><br><span class="line">    out.position = vector_float4(0.0, 0.0, 0.0, 1.0);</span><br><span class="line">    out.position.xy = pixelSpacePosition / (viewportSize / 2.0);</span><br><span class="line"></span><br><span class="line">    out.color = vertices[vertexID].color;</span><br><span class="line"></span><br><span class="line">    return out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fragment float4 fragmentShader(RasterizerData in [[stage_in]])</span><br><span class="line">&#123;</span><br><span class="line">    return in.color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们没有苹果的设备，所以没有运行结果，因为虚拟机上运行Xcode效率太差了，所以我直接把官方那的例子拿了过来，是的，唯有这个实在没办法实践，不过我们看看还是可以的。这里使用的语言是Object-C，不过别被这不习惯的写法搞害怕了，其实就是类型和名称倒过来而已，习惯go和kotlin的话应该不难，还有这“[]”，里面东西按顺序读的话，其实就是对象调用方法再加参数，总之习惯就好。metal这里已经开始使用一些现代的一些API思维了，如命令队列之类的，这里的上下文是直接由metal提供的view。其实，metal最让我觉得羡慕的是没有繁琐的配置过程，应该是它提供了大量默认值，与此同时，它还能在提供较为底层的API情况下写得如OpenGL差不多的简洁。在这里说可能没什么感受，大的要来了。</p>
<h1 id="directX12"><a href="#directX12" class="headerlink" title="directX12"></a>directX12</h1><p>源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line">#include &lt;wrl.h&gt;</span><br><span class="line">#include &lt;d3d12.h&gt;</span><br><span class="line">#include &lt;dxgi.h&gt;</span><br><span class="line">#include &lt;d3dcompiler.h&gt;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib,&quot;d3d12.lib&quot;)</span><br><span class="line">#pragma comment(lib, &quot;dxgi.lib&quot;)</span><br><span class="line">#pragma comment(lib, &quot;D3DCompiler.lib&quot;)</span><br><span class="line"></span><br><span class="line">int width = 720;</span><br><span class="line">int height = 540;</span><br><span class="line"></span><br><span class="line">int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR lpCmdLine, int nCmdShow)</span><br><span class="line">&#123;</span><br><span class="line">	// window</span><br><span class="line">	WNDCLASSEX wc = &#123; 0 &#125;;</span><br><span class="line">	wc.cbSize = sizeof(wc);</span><br><span class="line">	wc.style = CS_OWNDC;</span><br><span class="line">	wc.lpfnWndProc = DefWindowProc;</span><br><span class="line">	wc.cbClsExtra = 0;</span><br><span class="line">	wc.cbWndExtra = 0;</span><br><span class="line">	wc.hInstance = hInstance;</span><br><span class="line">	wc.hIcon = nullptr;</span><br><span class="line">	wc.hCursor = nullptr;</span><br><span class="line">	wc.hbrBackground = nullptr;</span><br><span class="line">	wc.lpszMenuName = nullptr;</span><br><span class="line">	wc.lpszClassName = TEXT(&quot;dx12Win&quot;);</span><br><span class="line">	wc.hIconSm = nullptr;</span><br><span class="line">	RegisterClassEx(&amp;wc);</span><br><span class="line"></span><br><span class="line">	HWND hWnd = CreateWindow(L&quot;dx12Win&quot;, L&quot;DirectX12Window&quot;, WS_CAPTION | WS_MINIMIZEBOX | WS_SYSMENU, CW_USEDEFAULT, CW_USEDEFAULT, width, height, nullptr, nullptr, hInstance, nullptr);</span><br><span class="line">	ShowWindow(hWnd, SW_SHOWDEFAULT);</span><br><span class="line"></span><br><span class="line">	//init</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;IDXGIFactory&gt; dxgiFactory;</span><br><span class="line">	CreateDXGIFactory(IID_PPV_ARGS(&amp;dxgiFactory));</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12Device&gt; device;</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;IDXGIAdapter&gt; dxgiAdapter;</span><br><span class="line">	for (UINT adapterIndex = 0; DXGI_ERROR_NOT_FOUND != dxgiFactory-&gt;EnumAdapters(adapterIndex, &amp;dxgiAdapter); ++adapterIndex)</span><br><span class="line">	&#123;</span><br><span class="line">		if (SUCCEEDED(D3D12CreateDevice(dxgiAdapter.Get(), D3D_FEATURE_LEVEL_11_0, _uuidof(ID3D12Device), nullptr)))</span><br><span class="line">			break;</span><br><span class="line">	&#125;</span><br><span class="line">	D3D12CreateDevice(dxgiAdapter.Get(), D3D_FEATURE_LEVEL_11_0, IID_PPV_ARGS(&amp;device));</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12CommandQueue&gt; commandQueue;</span><br><span class="line">	D3D12_COMMAND_QUEUE_DESC cqDesc = &#123;&#125;;</span><br><span class="line">	cqDesc.Flags = D3D12_COMMAND_QUEUE_FLAG_NONE;</span><br><span class="line">	cqDesc.Type = D3D12_COMMAND_LIST_TYPE_DIRECT;</span><br><span class="line">	device-&gt;CreateCommandQueue(&amp;cqDesc, IID_PPV_ARGS(&amp;commandQueue));</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;IDXGISwapChain&gt; swapChain;</span><br><span class="line">	DXGI_SWAP_CHAIN_DESC swapChainDesc = &#123;&#125;;</span><br><span class="line">	swapChainDesc.BufferCount = 2;</span><br><span class="line">	swapChainDesc.BufferDesc.Width = width;</span><br><span class="line">	swapChainDesc.BufferDesc.Height = height;</span><br><span class="line">	swapChainDesc.BufferDesc.Format = DXGI_FORMAT_R8G8B8A8_UNORM;</span><br><span class="line">	swapChainDesc.BufferUsage = DXGI_USAGE_RENDER_TARGET_OUTPUT;</span><br><span class="line">	swapChainDesc.SwapEffect = DXGI_SWAP_EFFECT_FLIP_DISCARD;</span><br><span class="line">	swapChainDesc.OutputWindow = hWnd;</span><br><span class="line">	swapChainDesc.SampleDesc.Count = 1;</span><br><span class="line">	swapChainDesc.Windowed = TRUE;</span><br><span class="line">	dxgiFactory-&gt;CreateSwapChain(commandQueue.Get(), &amp;swapChainDesc, &amp;swapChain);</span><br><span class="line">	int currentFrameIndex = 0;</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12DescriptorHeap&gt; rtvDescriptorHeap;</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12Resource&gt; pBackBuffer[2];</span><br><span class="line">	D3D12_DESCRIPTOR_HEAP_DESC rtvDesc = &#123;&#125;;</span><br><span class="line">	rtvDesc.Type = D3D12_DESCRIPTOR_HEAP_TYPE_RTV;</span><br><span class="line">	rtvDesc.NumDescriptors = 2;</span><br><span class="line">	rtvDesc.Flags = D3D12_DESCRIPTOR_HEAP_FLAG_NONE;</span><br><span class="line">	device-&gt;CreateDescriptorHeap(&amp;rtvDesc, IID_PPV_ARGS(&amp;rtvDescriptorHeap));</span><br><span class="line"></span><br><span class="line">	D3D12_CPU_DESCRIPTOR_HANDLE rtvHandle = rtvDescriptorHeap-&gt;GetCPUDescriptorHandleForHeapStart();</span><br><span class="line">	int rtvDescriptorSize = device-&gt;GetDescriptorHandleIncrementSize(D3D12_DESCRIPTOR_HEAP_TYPE_RTV);</span><br><span class="line">	for (int i = 0; i &lt; 2; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		swapChain-&gt;GetBuffer(i, IID_PPV_ARGS(&amp;pBackBuffer[i]));</span><br><span class="line">		device-&gt;CreateRenderTargetView(pBackBuffer[i].Get(), nullptr, rtvHandle);</span><br><span class="line">		rtvHandle.ptr += rtvDescriptorSize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12CommandAllocator&gt; commandAllocator;</span><br><span class="line">	device-&gt;CreateCommandAllocator(D3D12_COMMAND_LIST_TYPE_DIRECT, IID_PPV_ARGS(&amp;commandAllocator));</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12GraphicsCommandList&gt; commandList;</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12Fence&gt; fence;</span><br><span class="line">	device-&gt;CreateFence(0, D3D12_FENCE_FLAG_NONE, IID_PPV_ARGS(&amp;fence));</span><br><span class="line">	int fenceValue = 0;</span><br><span class="line">	HANDLE fenceEvent = CreateEvent(nullptr, FALSE, FALSE, nullptr);</span><br><span class="line"></span><br><span class="line">	//shader</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12RootSignature&gt; rootSignature;</span><br><span class="line">	D3D12_ROOT_SIGNATURE_DESC rsDesc = &#123; 0, nullptr, 0, nullptr, D3D12_ROOT_SIGNATURE_FLAG_ALLOW_INPUT_ASSEMBLER_INPUT_LAYOUT &#125;;</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3DBlob&gt; signatureBlob;</span><br><span class="line">	D3D12SerializeRootSignature(&amp;rsDesc, D3D_ROOT_SIGNATURE_VERSION_1_0, &amp;signatureBlob, nullptr);</span><br><span class="line">	device-&gt;CreateRootSignature(0, signatureBlob-&gt;GetBufferPointer(), signatureBlob-&gt;GetBufferSize(), IID_PPV_ARGS(&amp;rootSignature));</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3DBlob&gt; vertexShaderBlob;</span><br><span class="line">	D3DCompileFromFile(L&quot;VertexShader.hlsl&quot;, nullptr, nullptr, &quot;main&quot;, &quot;vs_5_0&quot;, D3DCOMPILE_DEBUG | D3DCOMPILE_SKIP_OPTIMIZATION, 0, &amp;vertexShaderBlob, nullptr);</span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3DBlob&gt; pixelShaderBlob;</span><br><span class="line">	D3DCompileFromFile(L&quot;PixelShader.hlsl&quot;, nullptr, nullptr, &quot;main&quot;, &quot;ps_5_0&quot;, D3DCOMPILE_DEBUG | D3DCOMPILE_SKIP_OPTIMIZATION, 0, &amp;pixelShaderBlob, nullptr);</span><br><span class="line"></span><br><span class="line">	const D3D12_INPUT_ELEMENT_DESC vertexLayout[] = &#123;</span><br><span class="line">	    &#123; &quot;POSITION&quot;, 0, DXGI_FORMAT_R32G32B32_FLOAT, 0, 0, D3D12_INPUT_CLASSIFICATION_PER_VERTEX_DATA, 0 &#125;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12PipelineState&gt; pso;</span><br><span class="line">	D3D12_GRAPHICS_PIPELINE_STATE_DESC psoDesc = &#123;&#125;;</span><br><span class="line">	psoDesc.pRootSignature = rootSignature.Get();</span><br><span class="line">	psoDesc.VS = &#123; vertexShaderBlob-&gt;GetBufferPointer(), vertexShaderBlob-&gt;GetBufferSize() &#125;;</span><br><span class="line">	psoDesc.PS = &#123; pixelShaderBlob-&gt;GetBufferPointer(), pixelShaderBlob-&gt;GetBufferSize() &#125;;</span><br><span class="line">	psoDesc.SampleMask = 0xffffffff;</span><br><span class="line">	const D3D12_RENDER_TARGET_BLEND_DESC defaultRenderTargetBlendDesc =</span><br><span class="line">	&#123;</span><br><span class="line">		FALSE,FALSE,</span><br><span class="line">		D3D12_BLEND_ONE, D3D12_BLEND_ZERO, D3D12_BLEND_OP_ADD,</span><br><span class="line">		D3D12_BLEND_ONE, D3D12_BLEND_ZERO, D3D12_BLEND_OP_ADD,</span><br><span class="line">		D3D12_LOGIC_OP_NOOP,</span><br><span class="line">		D3D12_COLOR_WRITE_ENABLE_ALL,</span><br><span class="line">	&#125;;</span><br><span class="line">	psoDesc.BlendState.AlphaToCoverageEnable = FALSE;</span><br><span class="line">	psoDesc.BlendState.IndependentBlendEnable = FALSE;</span><br><span class="line">	psoDesc.BlendState.RenderTarget[0] = defaultRenderTargetBlendDesc;</span><br><span class="line">	psoDesc.RasterizerState.FillMode = D3D12_FILL_MODE_SOLID;</span><br><span class="line">	psoDesc.RasterizerState.CullMode = D3D12_CULL_MODE_BACK;</span><br><span class="line">	psoDesc.DepthStencilState.DepthEnable = FALSE;</span><br><span class="line">	psoDesc.DepthStencilState.StencilEnable = FALSE;</span><br><span class="line">	psoDesc.InputLayout.pInputElementDescs = vertexLayout;</span><br><span class="line">	psoDesc.InputLayout.NumElements = sizeof(vertexLayout) / sizeof(D3D12_INPUT_ELEMENT_DESC);</span><br><span class="line">	psoDesc.PrimitiveTopologyType = D3D12_PRIMITIVE_TOPOLOGY_TYPE_TRIANGLE;</span><br><span class="line">	psoDesc.NumRenderTargets = 1;</span><br><span class="line">	psoDesc.RTVFormats[0] = DXGI_FORMAT_R8G8B8A8_UNORM;</span><br><span class="line">	psoDesc.DSVFormat = DXGI_FORMAT_D32_FLOAT;</span><br><span class="line">	psoDesc.SampleDesc = &#123; 1, 0 &#125;;</span><br><span class="line">	device-&gt;CreateGraphicsPipelineState(&amp;psoDesc, IID_PPV_ARGS(&amp;pso));</span><br><span class="line">	device-&gt;CreateCommandList(0, D3D12_COMMAND_LIST_TYPE_DIRECT, commandAllocator.Get(), pso.Get(), IID_PPV_ARGS(&amp;commandList));</span><br><span class="line">	commandList-&gt;Close();</span><br><span class="line"></span><br><span class="line">	//data</span><br><span class="line">	const float vertices[] = &#123;</span><br><span class="line">	  0.0f, 0.5f, 0.5f,</span><br><span class="line">	  0.3f, -0.0f, 0.5f,</span><br><span class="line">	  -0.3f, -0.0f, 0.5f</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	Microsoft::WRL::ComPtr&lt;ID3D12Resource&gt; vertexBuffer;</span><br><span class="line">	D3D12_VERTEX_BUFFER_VIEW vertexBufferView;</span><br><span class="line">	D3D12_HEAP_PROPERTIES hp = &#123;&#125;;</span><br><span class="line">	hp.Type = D3D12_HEAP_TYPE_UPLOAD;</span><br><span class="line">	D3D12_RESOURCE_DESC rd = &#123;&#125;;</span><br><span class="line">	rd.Dimension = D3D12_RESOURCE_DIMENSION_BUFFER;</span><br><span class="line">	rd.Width = sizeof(vertices);</span><br><span class="line">	rd.Height = 1;</span><br><span class="line">	rd.DepthOrArraySize = 1;</span><br><span class="line">	rd.MipLevels = 1;</span><br><span class="line">	rd.Flags = D3D12_RESOURCE_FLAG_NONE;</span><br><span class="line">	rd.Format = DXGI_FORMAT_UNKNOWN;</span><br><span class="line">	rd.SampleDesc = &#123;1, 0&#125;;</span><br><span class="line">	rd.Layout = D3D12_TEXTURE_LAYOUT_ROW_MAJOR;</span><br><span class="line">	device-&gt;CreateCommittedResource(&amp;hp, D3D12_HEAP_FLAG_NONE, &amp;rd, D3D12_RESOURCE_STATE_GENERIC_READ, nullptr, IID_PPV_ARGS(&amp;vertexBuffer));</span><br><span class="line"></span><br><span class="line">	void* pVertexDataBegin;</span><br><span class="line">	const D3D12_RANGE readRange = &#123; 0, 0 &#125;;</span><br><span class="line">	vertexBuffer-&gt;Map(0, &amp;readRange, &amp;pVertexDataBegin);</span><br><span class="line">	memcpy(pVertexDataBegin, vertices, sizeof(vertices));</span><br><span class="line">	vertexBuffer-&gt;Unmap(0, nullptr);</span><br><span class="line">	vertexBufferView.BufferLocation = vertexBuffer-&gt;GetGPUVirtualAddress();</span><br><span class="line">	vertexBufferView.StrideInBytes = 3 * sizeof(float);</span><br><span class="line">	vertexBufferView.SizeInBytes = sizeof(vertices);</span><br><span class="line"></span><br><span class="line">	D3D12_VIEWPORT viewport;</span><br><span class="line">	viewport.TopLeftX = 0;</span><br><span class="line">	viewport.TopLeftY = 0;</span><br><span class="line">	viewport.Width = (float)width;</span><br><span class="line">	viewport.Height = (float)height;</span><br><span class="line">	viewport.MinDepth = 0.0f;</span><br><span class="line">	viewport.MaxDepth = 1.0f;</span><br><span class="line">	D3D12_RECT scissorRect;</span><br><span class="line">	scissorRect.left = 0;</span><br><span class="line">	scissorRect.top = 0;</span><br><span class="line">	scissorRect.right = width;</span><br><span class="line">	scissorRect.bottom = height;</span><br><span class="line"></span><br><span class="line">	commandQueue-&gt;Signal(fence.Get(), 1);</span><br><span class="line"></span><br><span class="line">	//render</span><br><span class="line">	const float clearColor[] = &#123; 0.0f, 0.0f, 0.0f, 1.0f &#125;;</span><br><span class="line">	rtvHandle = rtvDescriptorHeap-&gt;GetCPUDescriptorHandleForHeapStart();</span><br><span class="line">	D3D12_RESOURCE_BARRIER barrierB = &#123;&#125;;</span><br><span class="line">	barrierB.Type = D3D12_RESOURCE_BARRIER_TYPE_TRANSITION;</span><br><span class="line">	barrierB.Flags = D3D12_RESOURCE_BARRIER_FLAG_NONE;</span><br><span class="line">	barrierB.Transition.pResource = pBackBuffer[0].Get();</span><br><span class="line">	barrierB.Transition.StateBefore = D3D12_RESOURCE_STATE_PRESENT;</span><br><span class="line">	barrierB.Transition.StateAfter = D3D12_RESOURCE_STATE_RENDER_TARGET;</span><br><span class="line">	barrierB.Transition.Subresource = D3D12_RESOURCE_BARRIER_ALL_SUBRESOURCES;</span><br><span class="line">	D3D12_RESOURCE_BARRIER barrierA = &#123;&#125;;</span><br><span class="line">	barrierA.Type = D3D12_RESOURCE_BARRIER_TYPE_TRANSITION;</span><br><span class="line">	barrierA.Flags = D3D12_RESOURCE_BARRIER_FLAG_NONE;</span><br><span class="line">	barrierA.Transition.pResource = pBackBuffer[0].Get();</span><br><span class="line">	barrierA.Transition.StateBefore = D3D12_RESOURCE_STATE_RENDER_TARGET;</span><br><span class="line">	barrierA.Transition.StateAfter = D3D12_RESOURCE_STATE_PRESENT;</span><br><span class="line">	barrierA.Transition.Subresource = D3D12_RESOURCE_BARRIER_ALL_SUBRESOURCES;</span><br><span class="line"></span><br><span class="line">	commandAllocator-&gt;Reset();</span><br><span class="line">	commandList-&gt;Reset(commandAllocator.Get(), pso.Get());</span><br><span class="line">	commandList-&gt;SetGraphicsRootSignature(rootSignature.Get());</span><br><span class="line">	commandList-&gt;RSSetViewports(1, &amp;viewport);</span><br><span class="line">	commandList-&gt;RSSetScissorRects(1, &amp;scissorRect);</span><br><span class="line"></span><br><span class="line">	commandList-&gt;ResourceBarrier(1, &amp;barrierB);</span><br><span class="line">	commandList-&gt;OMSetRenderTargets(1, &amp;rtvHandle, FALSE, nullptr);</span><br><span class="line">	commandList-&gt;ClearRenderTargetView(rtvHandle, clearColor, 0, nullptr);</span><br><span class="line"></span><br><span class="line">	commandList-&gt;IASetPrimitiveTopology(D3D_PRIMITIVE_TOPOLOGY_TRIANGLELIST);</span><br><span class="line">	commandList-&gt;IASetVertexBuffers(0, 1, &amp;vertexBufferView);</span><br><span class="line">	commandList-&gt;DrawInstanced(3, 1, 0, 0);</span><br><span class="line">	commandList-&gt;ResourceBarrier(1, &amp;barrierA);</span><br><span class="line">	commandList-&gt;Close();</span><br><span class="line"></span><br><span class="line">	ID3D12CommandList* ppCommandLists[] = &#123; commandList.Get() &#125;;</span><br><span class="line">	commandQueue-&gt;ExecuteCommandLists(_countof(ppCommandLists), ppCommandLists);</span><br><span class="line">	swapChain-&gt;Present(1, 0);</span><br><span class="line">	commandQueue-&gt;Signal(fence.Get(), 2);</span><br><span class="line"></span><br><span class="line">	//event</span><br><span class="line">	while (true)</span><br><span class="line">	&#123;</span><br><span class="line">		MSG msg;</span><br><span class="line">		while (PeekMessage(&amp;msg, nullptr, 0, 0, PM_REMOVE))</span><br><span class="line">		&#123;</span><br><span class="line">			TranslateMessage(&amp;msg);</span><br><span class="line">			DispatchMessage(&amp;msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>着色器与DierctX11相同，代码量差距如下  </p>
<img src="/archives/2022-01-17-%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0%E4%B9%8B%E6%B8%B2%E6%9F%93%E6%B8%B8%E8%AE%B0/p3.png" class="">  
<p>其实并没网上那么夸张，运行结果如下  </p>
<img src="/archives/2022-01-17-%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0%E4%B9%8B%E6%B8%B2%E6%9F%93%E6%B8%B8%E8%AE%B0/p4.png" class="">  
<p>网上大多例子，包括官方的，基本都是类的封装，使用的设备是<code>dgxi1_4.h</code>，而引入dx12用的都是辅助头<code>d3dx12.h</code>，这是官方推荐的，也是基本所有人的做法，不过我嘛，可是技术宅啊，当然要用更底层的东西了，而且我本身就不喜欢windows这种十分古老的API写法，却还得在类名称后面加数字什么的，这不得气死我这个强迫症啊。辅助头提供了什么？我们先说点其它的吧，依据官方的意思与理想，在这种API下，开发者可以更加的接近底层，拥有更多的控制权，这样就能更好得优化游戏了。但我对此提出了质疑，这好比什么，给你车让你开和给你车的部件让你造车再开一样，开发者做了更多的事情，但开发者真得有精力去思考更底层的优化吗？给我设备选择，给我命令队列，来进行优化选择吗？但就目前来看，做的事基本都是封装，然后退化到上一个时代，这是十分讽刺的一件事，甚至连官方的例子都是贴脸的告诉你，给我封装起来。或许是我见识短浅吧，但是如此多的配置不都是copy来的嘛，那些东西基本没啥好改的吧，却还非得再写一遍，开发者致力于上一层调优，又哪有时间来管这一层呢？API的目的本身就是来节约开发的，但却在图形方面往反方向发展，这绝对知道思考。<code>d3dx12.h</code>头文件其实就是在说明这件事情，它实际就是拿来简化配置用的，其实越是底层配置关联性就越大，出错概率就越大，虽说有调试层，但对开发者来说综究还是会厌烦的，而且我们都知道这到底有啥好优化的？最后，我想说一句话，你的那个<code>d3dx12.h</code>能不能好好封装，我已经出现好多次右值不能取地址的情况了。</p>
<h1 id="vulkan"><a href="#vulkan" class="headerlink" title="vulkan"></a>vulkan</h1><p>源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br></pre></td><td class="code"><pre><span class="line">#define GLFW_INCLUDE_VULKAN</span><br><span class="line">#include &lt;GLFW/glfw3.h&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;fstream&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;optional&gt;</span><br><span class="line">#include &lt;set&gt;</span><br><span class="line">#include &lt;array&gt;</span><br><span class="line"></span><br><span class="line">#pragma comment(lib, &quot;glfw3-x64.lib&quot;)</span><br><span class="line">#pragma comment(lib, &quot;vulkan-1.lib&quot;)</span><br><span class="line"></span><br><span class="line">const uint32_t WIDTH = 800;</span><br><span class="line">const uint32_t HEIGHT = 600;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    //window</span><br><span class="line">    glfwInit();</span><br><span class="line">    glfwWindowHint(GLFW_CLIENT_API, GLFW_NO_API);</span><br><span class="line">    GLFWwindow* window = glfwCreateWindow(WIDTH, HEIGHT, &quot;Vulkan&quot;, nullptr, nullptr);</span><br><span class="line"></span><br><span class="line">    //init</span><br><span class="line">    VkApplicationInfo appInfo&#123;&#125;;</span><br><span class="line">    appInfo.sType = VK_STRUCTURE_TYPE_APPLICATION_INFO;</span><br><span class="line">    appInfo.pApplicationName = &quot;Hello Triangle&quot;;</span><br><span class="line">    appInfo.applicationVersion = VK_MAKE_VERSION(1, 0, 0);</span><br><span class="line">    appInfo.pEngineName = &quot;No Engine&quot;;</span><br><span class="line">    appInfo.engineVersion = VK_MAKE_VERSION(1, 0, 0);</span><br><span class="line">    appInfo.apiVersion = VK_API_VERSION_1_0;</span><br><span class="line">    VkInstanceCreateInfo instanceInfo&#123;&#125;;</span><br><span class="line">    instanceInfo.sType = VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO;</span><br><span class="line">    instanceInfo.pApplicationInfo = &amp;appInfo;</span><br><span class="line"></span><br><span class="line">    uint32_t glfwExtensionCount = 0;</span><br><span class="line">    const char** glfwExtensions = glfwGetRequiredInstanceExtensions(&amp;glfwExtensionCount);</span><br><span class="line">    std::vector&lt;const char*&gt; extensions(glfwExtensions, glfwExtensions + glfwExtensionCount);</span><br><span class="line">    instanceInfo.enabledExtensionCount = static_cast&lt;uint32_t&gt;(extensions.size());</span><br><span class="line">    instanceInfo.ppEnabledExtensionNames = extensions.data();</span><br><span class="line">    instanceInfo.enabledLayerCount = 0;</span><br><span class="line">    instanceInfo.pNext = nullptr;</span><br><span class="line">    VkInstance instance;</span><br><span class="line">    vkCreateInstance(&amp;instanceInfo, nullptr, &amp;instance);</span><br><span class="line"></span><br><span class="line">    VkSurfaceKHR surface;</span><br><span class="line">    glfwCreateWindowSurface(instance, window, nullptr, &amp;surface);</span><br><span class="line"></span><br><span class="line">    uint32_t deviceCount = 0;</span><br><span class="line">    vkEnumeratePhysicalDevices(instance, &amp;deviceCount, nullptr);</span><br><span class="line">    std::vector&lt;VkPhysicalDevice&gt; devices(deviceCount);</span><br><span class="line">    vkEnumeratePhysicalDevices(instance, &amp;deviceCount, devices.data());</span><br><span class="line">    VkPhysicalDevice physicalDevice = devices[0];</span><br><span class="line"></span><br><span class="line">    std::vector&lt;VkDeviceQueueCreateInfo&gt; queueCreateInfos;</span><br><span class="line">    std::set&lt;uint32_t&gt; uniqueQueueFamilies = &#123; 0, 0 &#125;;</span><br><span class="line">    float queuePriority = 1.0f;</span><br><span class="line">    for (uint32_t queueFamily : uniqueQueueFamilies) &#123;</span><br><span class="line">        VkDeviceQueueCreateInfo queueCreateInfo&#123;&#125;;</span><br><span class="line">        queueCreateInfo.sType = VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO;</span><br><span class="line">        queueCreateInfo.queueFamilyIndex = queueFamily;</span><br><span class="line">        queueCreateInfo.queueCount = 1;</span><br><span class="line">        queueCreateInfo.pQueuePriorities = &amp;queuePriority;</span><br><span class="line">        queueCreateInfos.push_back(queueCreateInfo);</span><br><span class="line">    &#125;</span><br><span class="line">    VkPhysicalDeviceFeatures deviceFeatures&#123;&#125;;</span><br><span class="line">    VkDeviceCreateInfo deviceInfo&#123;&#125;;</span><br><span class="line">    deviceInfo.sType = VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO;</span><br><span class="line">    deviceInfo.queueCreateInfoCount = static_cast&lt;uint32_t&gt;(queueCreateInfos.size());</span><br><span class="line">    deviceInfo.pQueueCreateInfos = queueCreateInfos.data();</span><br><span class="line">    deviceInfo.pEnabledFeatures = &amp;deviceFeatures;</span><br><span class="line">    const std::vector&lt;const char*&gt; deviceExtensions = &#123;</span><br><span class="line">        VK_KHR_SWAPCHAIN_EXTENSION_NAME</span><br><span class="line">    &#125;;</span><br><span class="line">    deviceInfo.enabledExtensionCount = static_cast&lt;uint32_t&gt;(deviceExtensions.size());</span><br><span class="line">    deviceInfo.ppEnabledExtensionNames = deviceExtensions.data();</span><br><span class="line">    deviceInfo.enabledLayerCount = 0;</span><br><span class="line">    VkDevice device;</span><br><span class="line">    vkCreateDevice(physicalDevice, &amp;deviceInfo, nullptr, &amp;device);</span><br><span class="line">    VkQueue graphicsQueue;</span><br><span class="line">    VkQueue presentQueue;</span><br><span class="line">    vkGetDeviceQueue(device, 0, 0, &amp;graphicsQueue);</span><br><span class="line">    vkGetDeviceQueue(device, 0, 0, &amp;presentQueue);</span><br><span class="line"></span><br><span class="line">    VkSurfaceCapabilitiesKHR capabilities;</span><br><span class="line">    vkGetPhysicalDeviceSurfaceCapabilitiesKHR(physicalDevice, surface, &amp;capabilities);</span><br><span class="line">    uint32_t imageCount = capabilities.minImageCount + 1;</span><br><span class="line">    VkSwapchainCreateInfoKHR swapchainInfo&#123;&#125;;</span><br><span class="line">    swapchainInfo.sType = VK_STRUCTURE_TYPE_SWAPCHAIN_CREATE_INFO_KHR;</span><br><span class="line">    swapchainInfo.surface = surface;</span><br><span class="line">    swapchainInfo.minImageCount = imageCount;</span><br><span class="line">    swapchainInfo.imageFormat = VK_FORMAT_B8G8R8A8_SRGB;</span><br><span class="line">    swapchainInfo.imageColorSpace = VK_COLOR_SPACE_SRGB_NONLINEAR_KHR;</span><br><span class="line">    swapchainInfo.imageExtent = capabilities.currentExtent;</span><br><span class="line">    swapchainInfo.imageArrayLayers = 1;</span><br><span class="line">    swapchainInfo.imageUsage = VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT;</span><br><span class="line">    swapchainInfo.imageSharingMode = VK_SHARING_MODE_EXCLUSIVE;</span><br><span class="line">    swapchainInfo.preTransform = capabilities.currentTransform;</span><br><span class="line">    swapchainInfo.compositeAlpha = VK_COMPOSITE_ALPHA_OPAQUE_BIT_KHR;</span><br><span class="line">    swapchainInfo.presentMode = VK_PRESENT_MODE_MAILBOX_KHR;</span><br><span class="line">    swapchainInfo.clipped = VK_TRUE;</span><br><span class="line">    VkSwapchainKHR swapChain;</span><br><span class="line">    vkCreateSwapchainKHR(device, &amp;swapchainInfo, nullptr, &amp;swapChain);</span><br><span class="line">    vkGetSwapchainImagesKHR(device, swapChain, &amp;imageCount, nullptr);</span><br><span class="line">    std::vector&lt;VkImage&gt; swapChainImages(imageCount);</span><br><span class="line">    vkGetSwapchainImagesKHR(device, swapChain, &amp;imageCount, swapChainImages.data());</span><br><span class="line"></span><br><span class="line">    std::vector&lt;VkImageView&gt; swapChainImageViews(swapChainImages.size());</span><br><span class="line">    for (size_t i = 0; i &lt; swapChainImages.size(); i++) &#123;</span><br><span class="line">        VkImageViewCreateInfo createInfo&#123;&#125;;</span><br><span class="line">        createInfo.sType = VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO;</span><br><span class="line">        createInfo.image = swapChainImages[i];</span><br><span class="line">        createInfo.viewType = VK_IMAGE_VIEW_TYPE_2D;</span><br><span class="line">        createInfo.format = VK_FORMAT_B8G8R8A8_SRGB;</span><br><span class="line">        createInfo.components.r = VK_COMPONENT_SWIZZLE_IDENTITY;</span><br><span class="line">        createInfo.components.g = VK_COMPONENT_SWIZZLE_IDENTITY;</span><br><span class="line">        createInfo.components.b = VK_COMPONENT_SWIZZLE_IDENTITY;</span><br><span class="line">        createInfo.components.a = VK_COMPONENT_SWIZZLE_IDENTITY;</span><br><span class="line">        createInfo.subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</span><br><span class="line">        createInfo.subresourceRange.baseMipLevel = 0;</span><br><span class="line">        createInfo.subresourceRange.levelCount = 1;</span><br><span class="line">        createInfo.subresourceRange.baseArrayLayer = 0;</span><br><span class="line">        createInfo.subresourceRange.layerCount = 1;</span><br><span class="line">        vkCreateImageView(device, &amp;createInfo, nullptr, &amp;swapChainImageViews[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    VkAttachmentDescription colorAttachment&#123;&#125;;</span><br><span class="line">    colorAttachment.format = VK_FORMAT_B8G8R8A8_SRGB;</span><br><span class="line">    colorAttachment.samples = VK_SAMPLE_COUNT_1_BIT;</span><br><span class="line">    colorAttachment.loadOp = VK_ATTACHMENT_LOAD_OP_CLEAR;</span><br><span class="line">    colorAttachment.storeOp = VK_ATTACHMENT_STORE_OP_STORE;</span><br><span class="line">    colorAttachment.stencilLoadOp = VK_ATTACHMENT_LOAD_OP_DONT_CARE;</span><br><span class="line">    colorAttachment.stencilStoreOp = VK_ATTACHMENT_STORE_OP_DONT_CARE;</span><br><span class="line">    colorAttachment.initialLayout = VK_IMAGE_LAYOUT_UNDEFINED;</span><br><span class="line">    colorAttachment.finalLayout = VK_IMAGE_LAYOUT_PRESENT_SRC_KHR;</span><br><span class="line">    VkAttachmentReference colorAttachmentRef&#123;&#125;;</span><br><span class="line">    colorAttachmentRef.attachment = 0;</span><br><span class="line">    colorAttachmentRef.layout = VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL;</span><br><span class="line">    VkSubpassDescription subpass&#123;&#125;;</span><br><span class="line">    subpass.pipelineBindPoint = VK_PIPELINE_BIND_POINT_GRAPHICS;</span><br><span class="line">    subpass.colorAttachmentCount = 1;</span><br><span class="line">    subpass.pColorAttachments = &amp;colorAttachmentRef;</span><br><span class="line">    VkSubpassDependency dependency&#123;&#125;;</span><br><span class="line">    dependency.srcSubpass = VK_SUBPASS_EXTERNAL;</span><br><span class="line">    dependency.dstSubpass = 0;</span><br><span class="line">    dependency.srcStageMask = VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT;</span><br><span class="line">    dependency.srcAccessMask = 0;</span><br><span class="line">    dependency.dstStageMask = VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT;</span><br><span class="line">    dependency.dstAccessMask = VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT;</span><br><span class="line">    VkRenderPassCreateInfo renderPassInfo&#123;&#125;;</span><br><span class="line">    renderPassInfo.sType = VK_STRUCTURE_TYPE_RENDER_PASS_CREATE_INFO;</span><br><span class="line">    renderPassInfo.attachmentCount = 1;</span><br><span class="line">    renderPassInfo.pAttachments = &amp;colorAttachment;</span><br><span class="line">    renderPassInfo.subpassCount = 1;</span><br><span class="line">    renderPassInfo.pSubpasses = &amp;subpass;</span><br><span class="line">    renderPassInfo.dependencyCount = 1;</span><br><span class="line">    renderPassInfo.pDependencies = &amp;dependency;</span><br><span class="line">    VkRenderPass renderPass;</span><br><span class="line">    vkCreateRenderPass(device, &amp;renderPassInfo, nullptr, &amp;renderPass);</span><br><span class="line"></span><br><span class="line">    //data</span><br><span class="line">    VkBufferCreateInfo bufferInfo&#123;&#125;;</span><br><span class="line">    bufferInfo.sType = VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO;</span><br><span class="line">    bufferInfo.size = 3 * 2 * sizeof(float);</span><br><span class="line">    bufferInfo.usage = VK_BUFFER_USAGE_VERTEX_BUFFER_BIT;</span><br><span class="line">    bufferInfo.sharingMode = VK_SHARING_MODE_EXCLUSIVE;</span><br><span class="line">    VkBuffer vertexBuffer;</span><br><span class="line">    vkCreateBuffer(device, &amp;bufferInfo, nullptr, &amp;vertexBuffer);</span><br><span class="line">    VkMemoryRequirements memRequirements;</span><br><span class="line">    vkGetBufferMemoryRequirements(device, vertexBuffer, &amp;memRequirements);</span><br><span class="line">    VkMemoryAllocateInfo vbAllocInfo&#123;&#125;;</span><br><span class="line">    vbAllocInfo.sType = VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO;</span><br><span class="line">    vbAllocInfo.allocationSize = memRequirements.size;</span><br><span class="line">    VkPhysicalDeviceMemoryProperties memProperties;</span><br><span class="line">    vkGetPhysicalDeviceMemoryProperties(physicalDevice, &amp;memProperties);</span><br><span class="line">    for (uint32_t i = 0; i &lt; memProperties.memoryTypeCount; i++) &#123;</span><br><span class="line">        if ((memRequirements.memoryTypeBits &amp; (1 &lt;&lt; i)) &amp;&amp; (memProperties.memoryTypes[i].propertyFlags &amp; (VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT | VK_MEMORY_PROPERTY_HOST_COHERENT_BIT)) == (VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT | VK_MEMORY_PROPERTY_HOST_COHERENT_BIT)) &#123;</span><br><span class="line">            vbAllocInfo.memoryTypeIndex = i;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    VkDeviceMemory vertexBufferMemory;</span><br><span class="line">    vkAllocateMemory(device, &amp;vbAllocInfo, nullptr, &amp;vertexBufferMemory);</span><br><span class="line">    vkBindBufferMemory(device, vertexBuffer, vertexBufferMemory, 0);</span><br><span class="line">    const float vertices[6] = &#123;</span><br><span class="line">        0.0f, -0.5f,</span><br><span class="line">        0.5f, 0.5f,</span><br><span class="line">        -0.5f, 0.5f</span><br><span class="line">    &#125;;</span><br><span class="line">    void* data;</span><br><span class="line">    vkMapMemory(device, vertexBufferMemory, 0, bufferInfo.size, 0, &amp;data);</span><br><span class="line">    memcpy(data, vertices, (size_t)bufferInfo.size);</span><br><span class="line">    vkUnmapMemory(device, vertexBufferMemory);</span><br><span class="line"></span><br><span class="line">    //shader</span><br><span class="line">    std::ifstream file(&quot;vert.spv&quot;, std::ios::ate | std::ios::binary);</span><br><span class="line">    size_t fileSize = (size_t)file.tellg();</span><br><span class="line">    std::vector&lt;char&gt; vertShaderCode(fileSize);</span><br><span class="line">    file.seekg(0);</span><br><span class="line">    file.read(vertShaderCode.data(), fileSize);</span><br><span class="line">    file.close();</span><br><span class="line">    VkShaderModuleCreateInfo vertCreateInfo&#123;&#125;;</span><br><span class="line">    vertCreateInfo.sType = VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO;</span><br><span class="line">    vertCreateInfo.codeSize = vertShaderCode.size();</span><br><span class="line">    vertCreateInfo.pCode = reinterpret_cast&lt;const uint32_t*&gt;(vertShaderCode.data());</span><br><span class="line">    VkShaderModule vertShaderModule;</span><br><span class="line">    vkCreateShaderModule(device, &amp;vertCreateInfo, nullptr, &amp;vertShaderModule);</span><br><span class="line"></span><br><span class="line">    file.open(&quot;frag.spv&quot;, std::ios::ate | std::ios::binary);</span><br><span class="line">    fileSize = (size_t)file.tellg();</span><br><span class="line">    std::vector&lt;char&gt; fragShaderCode(fileSize);</span><br><span class="line">    file.seekg(0);</span><br><span class="line">    file.read(fragShaderCode.data(), fileSize);</span><br><span class="line">    file.close();</span><br><span class="line">    VkShaderModuleCreateInfo fragCreateInfo&#123;&#125;;</span><br><span class="line">    fragCreateInfo.sType = VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO;</span><br><span class="line">    fragCreateInfo.codeSize = fragShaderCode.size();</span><br><span class="line">    fragCreateInfo.pCode = reinterpret_cast&lt;const uint32_t*&gt;(fragShaderCode.data());</span><br><span class="line">    VkShaderModule fragShaderModule;</span><br><span class="line">    vkCreateShaderModule(device, &amp;fragCreateInfo, nullptr, &amp;fragShaderModule);</span><br><span class="line"></span><br><span class="line">    VkPipelineShaderStageCreateInfo vertShaderStageInfo&#123;&#125;;</span><br><span class="line">    vertShaderStageInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_SHADER_STAGE_CREATE_INFO;</span><br><span class="line">    vertShaderStageInfo.stage = VK_SHADER_STAGE_VERTEX_BIT;</span><br><span class="line">    vertShaderStageInfo.module = vertShaderModule;</span><br><span class="line">    vertShaderStageInfo.pName = &quot;main&quot;;</span><br><span class="line">    VkPipelineShaderStageCreateInfo fragShaderStageInfo&#123;&#125;;</span><br><span class="line">    fragShaderStageInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_SHADER_STAGE_CREATE_INFO;</span><br><span class="line">    fragShaderStageInfo.stage = VK_SHADER_STAGE_FRAGMENT_BIT;</span><br><span class="line">    fragShaderStageInfo.module = fragShaderModule;</span><br><span class="line">    fragShaderStageInfo.pName = &quot;main&quot;;</span><br><span class="line">    VkPipelineShaderStageCreateInfo shaderStages[] = &#123; vertShaderStageInfo, fragShaderStageInfo &#125;;</span><br><span class="line">    VkPipelineVertexInputStateCreateInfo vertexInputInfo&#123;&#125;;</span><br><span class="line">    vertexInputInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_VERTEX_INPUT_STATE_CREATE_INFO;</span><br><span class="line">    VkVertexInputBindingDescription bindingDescription&#123;&#125;;</span><br><span class="line">    bindingDescription.binding = 0;</span><br><span class="line">    bindingDescription.stride = 2 * sizeof(float);</span><br><span class="line">    bindingDescription.inputRate = VK_VERTEX_INPUT_RATE_VERTEX;</span><br><span class="line">    std::array&lt;VkVertexInputAttributeDescription, 1&gt; attributeDescriptions&#123;&#125;;</span><br><span class="line">    attributeDescriptions[0].binding = 0;</span><br><span class="line">    attributeDescriptions[0].location = 0;</span><br><span class="line">    attributeDescriptions[0].format = VK_FORMAT_R32G32_SFLOAT;</span><br><span class="line">    attributeDescriptions[0].offset = (uint32_t)0;</span><br><span class="line">    vertexInputInfo.vertexBindingDescriptionCount = 1;</span><br><span class="line">    vertexInputInfo.vertexAttributeDescriptionCount = static_cast&lt;uint32_t&gt;(attributeDescriptions.size());</span><br><span class="line">    vertexInputInfo.pVertexBindingDescriptions = &amp;bindingDescription;</span><br><span class="line">    vertexInputInfo.pVertexAttributeDescriptions = attributeDescriptions.data();</span><br><span class="line"></span><br><span class="line">    VkPipelineInputAssemblyStateCreateInfo inputAssembly&#123;&#125;;</span><br><span class="line">    inputAssembly.sType = VK_STRUCTURE_TYPE_PIPELINE_INPUT_ASSEMBLY_STATE_CREATE_INFO;</span><br><span class="line">    inputAssembly.topology = VK_PRIMITIVE_TOPOLOGY_TRIANGLE_LIST;</span><br><span class="line">    inputAssembly.primitiveRestartEnable = VK_FALSE;</span><br><span class="line">    VkViewport viewport&#123;&#125;;</span><br><span class="line">    viewport.x = 0.0f;</span><br><span class="line">    viewport.y = 0.0f;</span><br><span class="line">    viewport.width = WIDTH;</span><br><span class="line">    viewport.height = HEIGHT;</span><br><span class="line">    viewport.minDepth = 0.0f;</span><br><span class="line">    viewport.maxDepth = 1.0f;</span><br><span class="line">    VkRect2D scissor&#123;&#125;;</span><br><span class="line">    scissor.offset = &#123; 0, 0 &#125;;</span><br><span class="line">    scissor.extent = capabilities.currentExtent;</span><br><span class="line">    VkPipelineViewportStateCreateInfo viewportState&#123;&#125;;</span><br><span class="line">    viewportState.sType = VK_STRUCTURE_TYPE_PIPELINE_VIEWPORT_STATE_CREATE_INFO;</span><br><span class="line">    viewportState.viewportCount = 1;</span><br><span class="line">    viewportState.pViewports = &amp;viewport;</span><br><span class="line">    viewportState.scissorCount = 1;</span><br><span class="line">    viewportState.pScissors = &amp;scissor;</span><br><span class="line">    VkPipelineRasterizationStateCreateInfo rasterizer&#123;&#125;;</span><br><span class="line">    rasterizer.sType = VK_STRUCTURE_TYPE_PIPELINE_RASTERIZATION_STATE_CREATE_INFO;</span><br><span class="line">    rasterizer.depthClampEnable = VK_FALSE;</span><br><span class="line">    rasterizer.rasterizerDiscardEnable = VK_FALSE;</span><br><span class="line">    rasterizer.polygonMode = VK_POLYGON_MODE_FILL;</span><br><span class="line">    rasterizer.lineWidth = 1.0f;</span><br><span class="line">    rasterizer.cullMode = VK_CULL_MODE_BACK_BIT;</span><br><span class="line">    rasterizer.frontFace = VK_FRONT_FACE_CLOCKWISE;</span><br><span class="line">    rasterizer.depthBiasEnable = VK_FALSE;</span><br><span class="line">    VkPipelineMultisampleStateCreateInfo multisampling&#123;&#125;;</span><br><span class="line">    multisampling.sType = VK_STRUCTURE_TYPE_PIPELINE_MULTISAMPLE_STATE_CREATE_INFO;</span><br><span class="line">    multisampling.sampleShadingEnable = VK_FALSE;</span><br><span class="line">    multisampling.rasterizationSamples = VK_SAMPLE_COUNT_1_BIT;</span><br><span class="line">    VkPipelineColorBlendAttachmentState colorBlendAttachment&#123;&#125;;</span><br><span class="line">    colorBlendAttachment.colorWriteMask = VK_COLOR_COMPONENT_R_BIT | VK_COLOR_COMPONENT_G_BIT | VK_COLOR_COMPONENT_B_BIT | VK_COLOR_COMPONENT_A_BIT;</span><br><span class="line">    colorBlendAttachment.blendEnable = VK_FALSE;</span><br><span class="line">    VkPipelineColorBlendStateCreateInfo colorBlending&#123;&#125;;</span><br><span class="line">    colorBlending.sType = VK_STRUCTURE_TYPE_PIPELINE_COLOR_BLEND_STATE_CREATE_INFO;</span><br><span class="line">    colorBlending.logicOpEnable = VK_FALSE;</span><br><span class="line">    colorBlending.logicOp = VK_LOGIC_OP_COPY;</span><br><span class="line">    colorBlending.attachmentCount = 1;</span><br><span class="line">    colorBlending.pAttachments = &amp;colorBlendAttachment;</span><br><span class="line">    colorBlending.blendConstants[0] = 0.0f;</span><br><span class="line">    colorBlending.blendConstants[1] = 0.0f;</span><br><span class="line">    colorBlending.blendConstants[2] = 0.0f;</span><br><span class="line">    colorBlending.blendConstants[3] = 0.0f;</span><br><span class="line">    VkPipelineLayoutCreateInfo pipelineLayoutInfo&#123;&#125;;</span><br><span class="line">    pipelineLayoutInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_LAYOUT_CREATE_INFO;</span><br><span class="line">    pipelineLayoutInfo.setLayoutCount = 0;</span><br><span class="line">    pipelineLayoutInfo.pushConstantRangeCount = 0;</span><br><span class="line">    VkPipelineLayout pipelineLayout;</span><br><span class="line">    vkCreatePipelineLayout(device, &amp;pipelineLayoutInfo, nullptr, &amp;pipelineLayout);</span><br><span class="line">    VkGraphicsPipelineCreateInfo pipelineInfo&#123;&#125;;</span><br><span class="line">    pipelineInfo.sType = VK_STRUCTURE_TYPE_GRAPHICS_PIPELINE_CREATE_INFO;</span><br><span class="line">    pipelineInfo.stageCount = 2;</span><br><span class="line">    pipelineInfo.pStages = shaderStages;</span><br><span class="line">    pipelineInfo.pVertexInputState = &amp;vertexInputInfo;</span><br><span class="line">    pipelineInfo.pInputAssemblyState = &amp;inputAssembly;</span><br><span class="line">    pipelineInfo.pViewportState = &amp;viewportState;</span><br><span class="line">    pipelineInfo.pRasterizationState = &amp;rasterizer;</span><br><span class="line">    pipelineInfo.pMultisampleState = &amp;multisampling;</span><br><span class="line">    pipelineInfo.pColorBlendState = &amp;colorBlending;</span><br><span class="line">    pipelineInfo.layout = pipelineLayout;</span><br><span class="line">    pipelineInfo.renderPass = renderPass;</span><br><span class="line">    pipelineInfo.subpass = 0;</span><br><span class="line">    pipelineInfo.basePipelineHandle = VK_NULL_HANDLE;</span><br><span class="line">    VkPipeline graphicsPipeline;</span><br><span class="line">    vkCreateGraphicsPipelines(device, VK_NULL_HANDLE, 1, &amp;pipelineInfo, nullptr, &amp;graphicsPipeline);</span><br><span class="line">    vkDestroyShaderModule(device, fragShaderModule, nullptr);</span><br><span class="line">    vkDestroyShaderModule(device, vertShaderModule, nullptr);</span><br><span class="line"></span><br><span class="line">    std::vector&lt;VkFramebuffer&gt; swapChainFramebuffers(swapChainImageViews.size());</span><br><span class="line">    for (size_t i = 0; i &lt; swapChainImageViews.size(); i++) &#123;</span><br><span class="line">        VkImageView attachments[] = &#123;</span><br><span class="line">            swapChainImageViews[i]</span><br><span class="line">        &#125;;</span><br><span class="line">        VkFramebufferCreateInfo framebufferInfo&#123;&#125;;</span><br><span class="line">        framebufferInfo.sType = VK_STRUCTURE_TYPE_FRAMEBUFFER_CREATE_INFO;</span><br><span class="line">        framebufferInfo.renderPass = renderPass;</span><br><span class="line">        framebufferInfo.attachmentCount = 1;</span><br><span class="line">        framebufferInfo.pAttachments = attachments;</span><br><span class="line">        framebufferInfo.width = WIDTH;</span><br><span class="line">        framebufferInfo.height = HEIGHT;</span><br><span class="line">        framebufferInfo.layers = 1;</span><br><span class="line">        vkCreateFramebuffer(device, &amp;framebufferInfo, nullptr, &amp;swapChainFramebuffers[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    VkCommandPoolCreateInfo poolInfo&#123;&#125;;</span><br><span class="line">    poolInfo.sType = VK_STRUCTURE_TYPE_COMMAND_POOL_CREATE_INFO;</span><br><span class="line">    poolInfo.queueFamilyIndex = 0;</span><br><span class="line">    VkCommandPool commandPool;</span><br><span class="line">    vkCreateCommandPool(device, &amp;poolInfo, nullptr, &amp;commandPool);</span><br><span class="line"></span><br><span class="line">    std::vector&lt;VkCommandBuffer&gt; commandBuffers(swapChainFramebuffers.size());</span><br><span class="line">    VkCommandBufferAllocateInfo allocInfo&#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.commandPool = commandPool;</span><br><span class="line">    allocInfo.level = VK_COMMAND_BUFFER_LEVEL_PRIMARY;</span><br><span class="line">    allocInfo.commandBufferCount = (uint32_t)commandBuffers.size();</span><br><span class="line">    vkAllocateCommandBuffers(device, &amp;allocInfo, commandBuffers.data());</span><br><span class="line">    for (size_t i = 0; i &lt; commandBuffers.size(); i++) &#123;</span><br><span class="line">        VkCommandBufferBeginInfo beginInfo&#123;&#125;;</span><br><span class="line">        beginInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO;</span><br><span class="line">        vkBeginCommandBuffer(commandBuffers[i], &amp;beginInfo);</span><br><span class="line">        VkRenderPassBeginInfo renderPassInfo&#123;&#125;;</span><br><span class="line">        renderPassInfo.sType = VK_STRUCTURE_TYPE_RENDER_PASS_BEGIN_INFO;</span><br><span class="line">        renderPassInfo.renderPass = renderPass;</span><br><span class="line">        renderPassInfo.framebuffer = swapChainFramebuffers[i];</span><br><span class="line">        renderPassInfo.renderArea.offset = &#123; 0, 0 &#125;;</span><br><span class="line">        renderPassInfo.renderArea.extent = capabilities.currentExtent;</span><br><span class="line">        VkClearValue clearColor = &#123; &#123;&#123;0.0f, 0.0f, 0.0f, 1.0f&#125;&#125; &#125;;</span><br><span class="line">        renderPassInfo.clearValueCount = 1;</span><br><span class="line">        renderPassInfo.pClearValues = &amp;clearColor;</span><br><span class="line">        vkCmdBeginRenderPass(commandBuffers[i], &amp;renderPassInfo, VK_SUBPASS_CONTENTS_INLINE);</span><br><span class="line">        vkCmdBindPipeline(commandBuffers[i], VK_PIPELINE_BIND_POINT_GRAPHICS, graphicsPipeline);</span><br><span class="line">        VkBuffer vertexBuffers[] = &#123; vertexBuffer &#125;;</span><br><span class="line">        VkDeviceSize offsets[] = &#123; 0 &#125;;</span><br><span class="line">        vkCmdBindVertexBuffers(commandBuffers[i], 0, 1, vertexBuffers, offsets);</span><br><span class="line">        vkCmdDraw(commandBuffers[i], 3, 1, 0, 0);</span><br><span class="line">        vkCmdEndRenderPass(commandBuffers[i]);</span><br><span class="line">        vkEndCommandBuffer(commandBuffers[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::vector&lt;VkSemaphore&gt; imageAvailableSemaphores(2);</span><br><span class="line">    std::vector&lt;VkSemaphore&gt; renderFinishedSemaphores(2);</span><br><span class="line">    std::vector&lt;VkFence&gt; inFlightFences(2);</span><br><span class="line">    std::vector&lt;VkFence&gt; imagesInFlight(swapChainImages.size(), VK_NULL_HANDLE);</span><br><span class="line">    VkSemaphoreCreateInfo semaphoreInfo&#123;&#125;;</span><br><span class="line">    semaphoreInfo.sType = VK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO;</span><br><span class="line">    VkFenceCreateInfo fenceInfo&#123;&#125;;</span><br><span class="line">    fenceInfo.sType = VK_STRUCTURE_TYPE_FENCE_CREATE_INFO;</span><br><span class="line">    fenceInfo.flags = VK_FENCE_CREATE_SIGNALED_BIT;</span><br><span class="line">    for (size_t i = 0; i &lt; 2; i++) &#123;</span><br><span class="line">        vkCreateSemaphore(device, &amp;semaphoreInfo, nullptr, &amp;imageAvailableSemaphores[i]);</span><br><span class="line">        vkCreateSemaphore(device, &amp;semaphoreInfo, nullptr, &amp;renderFinishedSemaphores[i]);</span><br><span class="line">        vkCreateFence(device, &amp;fenceInfo, nullptr, &amp;inFlightFences[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //draw</span><br><span class="line">    uint32_t imageIndex = 0;</span><br><span class="line">    vkWaitForFences(device, 1, &amp;inFlightFences[0], VK_TRUE, UINT64_MAX);</span><br><span class="line">    VkSubmitInfo submitInfo&#123;&#125;;</span><br><span class="line">    submitInfo.sType = VK_STRUCTURE_TYPE_SUBMIT_INFO;</span><br><span class="line">    VkSemaphore waitSemaphores[] = &#123; imageAvailableSemaphores[0] &#125;;</span><br><span class="line">    VkPipelineStageFlags waitStages[] = &#123; VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT &#125;;</span><br><span class="line">    submitInfo.waitSemaphoreCount = 1;</span><br><span class="line">    submitInfo.pWaitSemaphores = waitSemaphores;</span><br><span class="line">    submitInfo.pWaitDstStageMask = waitStages;</span><br><span class="line">    submitInfo.commandBufferCount = 1;</span><br><span class="line">    submitInfo.pCommandBuffers = &amp;commandBuffers[0];</span><br><span class="line">    VkSemaphore signalSemaphores[] = &#123; renderFinishedSemaphores[0] &#125;;</span><br><span class="line">    submitInfo.signalSemaphoreCount = 1;</span><br><span class="line">    submitInfo.pSignalSemaphores = signalSemaphores;</span><br><span class="line">    vkResetFences(device, 1, &amp;inFlightFences[0]);</span><br><span class="line">    vkQueueSubmit(graphicsQueue, 1, &amp;submitInfo, inFlightFences[0]);</span><br><span class="line">    VkPresentInfoKHR presentInfo&#123;&#125;;</span><br><span class="line">    presentInfo.sType = VK_STRUCTURE_TYPE_PRESENT_INFO_KHR;</span><br><span class="line">    presentInfo.waitSemaphoreCount = 1;</span><br><span class="line">    presentInfo.pWaitSemaphores = signalSemaphores;</span><br><span class="line">    VkSwapchainKHR swapChains[] = &#123; swapChain &#125;;</span><br><span class="line">    presentInfo.swapchainCount = 1;</span><br><span class="line">    presentInfo.pSwapchains = swapChains;</span><br><span class="line">    presentInfo.pImageIndices = &amp;imageIndex;</span><br><span class="line">    vkQueuePresentKHR(presentQueue, &amp;presentInfo);</span><br><span class="line">    </span><br><span class="line">    //event</span><br><span class="line">    while (!glfwWindowShouldClose(window)) &#123;</span><br><span class="line">        glfwPollEvents();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //clear</span><br><span class="line">    //大量清除代码，实在不行写了</span><br><span class="line">    glfwDestroyWindow(window);</span><br><span class="line">    glfwTerminate();</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>顶点着色器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#version 450</span><br><span class="line"></span><br><span class="line">layout(location = 0) in vec2 inPosition;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">    gl_Position = vec4(inPosition, 0.0, 1.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>片段着色器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#version 450</span><br><span class="line"></span><br><span class="line">layout(location = 0) out vec4 outColor;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">    outColor = vec4(1.0, 1.0, 1.0, 1.0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果  </p>
<img src="/archives/2022-01-17-%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0%E4%B9%8B%E6%B8%B2%E6%9F%93%E6%B8%B8%E8%AE%B0/p5.png" class="">  
<p>接近400多行，而且还没写相关的清除代码，说实在的与其用这个，还不如dx12，错了，应该是OpenGL。对于OpenGL，目前我觉得缺少的一个功能就是提前对着色器的编译，而其它的功能，真得太够了。vulkan感觉就是跨平台版dx12的复刻，学啥不好，非得把这离谱的配置系统给学过来。vulkan需要依赖glfw这没得说，但清除真得太繁琐了，这是跨平台的劣势，还有一个就是这里对着色器代码的读取，文件管理属于平台相关的东西，所以并不能直接像dx12一样直接从文件获得着色器对象，而要通过C++标准库来读取文件，然后再转化为着色器对象。我们还要说一个事，官方的例子同样是封装过的，我是通过学习解剖才得到上面这些代码的，但千万别和我学，因为相关检测和调试代码全被我删了，也就是说硬件与我不同的话，极有可能出问题，我想表达什么呢？跨平台的本质应该是与硬件无关的，但现在的API却还要我们去自己进行相关的平台检测，自己选择相应设备，自己构造渲染队列，但是我们真得会去思考其中的优化处吗？就像之前所说，我只会把封装直接拿来，然后回到上一个时代。</p>
<h1 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h1><p>到这里，这场旅行也该告一段落了，至于更老的API就算了吧。最后我需要找出适合自己开发研究的API了，一些低耗能的那必定是OpenGL了，跨平台和易用性这就够了，而高性能的嘛，当然是游戏引擎了，除了游戏难道有什么App会需要如此多的性能呢？不过有点值得肯定，我对新API并不看好，除非计算机的底层体系发生改变。</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%B8%B2%E6%9F%93/">渲染</a><a class="post-meta__tags" href="/tags/%E7%BC%96%E7%A8%8B%E6%89%8B%E8%AE%B0/">编程手记</a></div><div class="post_share"></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">逯晓零</div><div class="author-info__description">我喜欢简洁，仅此而已。</div></div><div class="card-info-data site-data is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">65</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OpenGL"><span class="toc-number">1.</span> <span class="toc-text">OpenGL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DirectX11"><span class="toc-number">2.</span> <span class="toc-text">DirectX11</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#metal"><span class="toc-number">3.</span> <span class="toc-text">metal</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#directX12"><span class="toc-number">4.</span> <span class="toc-text">directX12</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vulkan"><span class="toc-number">5.</span> <span class="toc-text">vulkan</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E5%B0%BE"><span class="toc-number">6.</span> <span class="toc-text">结尾</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2024-09-30-Rust-%E9%9A%8F%E4%BE%BF%E7%9C%8B%E7%9C%8B%E5%90%A7/" title="Rust--随便看看吧">Rust--随便看看吧</a><time datetime="2024-09-30T11:55:45.000Z" title="发表于 2024-09-30 19:55:45">2024-09-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2024-09-11-%E6%96%87%E9%9D%92%E7%97%85%E2%80%94%E2%80%94%E7%94%B1%E6%AD%A4%E8%80%8C%E6%9D%A5/" title="文青病——由此而来">文青病——由此而来</a><time datetime="2024-09-11T13:46:26.000Z" title="发表于 2024-09-11 21:46:26">2024-09-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/archives/2024-08-18-%E6%9C%AC%E7%A7%91%E6%96%87%E9%9B%86/" title="本科文集">本科文集</a><time datetime="2024-08-18T11:15:00.000Z" title="发表于 2024-08-18 19:15:00">2024-08-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 逯晓零</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div></div></body></html>